---
publish: true
tags: 
aliases: 
finished: true
title: 题44
created: "2024-11-21 06:42"
updated: "2024-11-21 07:40"
---
## 题44
### 题目
> [!question]+
> （13 分）
> 
> 某 16 位计算机中，带符号整数用补码表示，数据 Cache 和指令 Cache 分离。下表给出了指令系统中部分指令格式，其中 Rs 和 Rd 表示寄存器，mem 表示存储单元地址，(x) 表示寄存器 x 或存储单元 x 的内容。
> 
> 指令系统中部分指令格式
> 
> $\begin{array}{|c|}\hline \text{名称}&\text{指令的汇编格式}&\text{指令功能}\\\hline \text{加法指令}&\text{ADD Rs,Rd}&\text{(Rs)+(Rd)→Rd}\\ \text{算术/逻辑左移}&\text{SHL Rd}&\text{2*(Rd)→Rd}\\ \text{算术右移}&\text{SHR Rd}&\text{(Rd)/2→Rd}\\ \text{取数指令}&\text{LOAD Rd, mem}&\text{(mem)→Rd}\\ \text{存数质量}&\text{STORE Rs, mem}&\text{(Rs)→mem}\\ \hline\end{array}$
> 
> 该计算机采用 5 段流水方式执行指令，各流水段分别是取指（IF）、译码 / 读寄存器（ID）、执行 / 计算有效地址（EX）、访问存储器（M）和结果写回寄存器（WB），流水线采用 “按序发射，按序完成” 方式，没有采用转发技术处理数据相关，并且同一个寄存器的读和写操作不能在同一个时钟周期内进行。请回答下列问题：
> 
> (1) 若 int 型变量 x 的值为 - 513，存放在寄存器 R1 中，则执行指令 “SHR R1” 后，R1 的内容是多少（用十六进制表示）？
> 
> (2) 若某个时间段中，有连续的 4 条指令进入流水线，在其执行过程中没有发生任何阻塞，则执行这 4 条指令所需的时钟周期数为多少？
> 
> (3) 若高级语言程序中某赋值语句为 x=a+b，x、a 和 b 均为 int 型变量，它们的存储单元地址分别表示为 [x]、[a] 和[b]。该语句对应的指令序列及其在指令流水线中的执行过程如下图所示。
> 
> $\begin{array}{cc} \text{I}_1&\text{LOAD R1, [a]}\\ \text{I}_2&\text{LOAD R2, [b]}\\ \text{I}_3&\text{ADD R1, R2}\\ \text{I}_4&\text{STORE R2, [x]} \end{array}$
> 
> ![](https://pic2.zhimg.com/v2-e3ab86132a96d1489fde7ea026812517_r.jpg)
> 
> 则这 4 条指令执行过程中，I3 的 ID 段和 I4 的 IF 段被阻塞的原因各是什么？
> 
> (4) 若高级语言程序中某赋值语句为 `x=x*2+a`，x 和 a 均为 unsigned int 类型变量，它们的存储单元地址分别表示为 `[x]`、`[a]`，则执行这条语句至少需要多少个时钟周期？要求模仿题 44 图画出这条语句对应的指令序列及其在流水线中的执行过程示意图。
### 解
> [!done]+
> (1) 因为计算机计算机字长为 16 位，带符号整数用补码表示， $[\rm x]_{\text{原}}=-513=-(2^9+1)=1000001000000001{\rm B}$ ， $[\rm x]_{\text{补}} = 1111110111111111{\rm B}$ ，x 存放在寄存器 R1 中，执行指令 “SHR R1”，x 为有符号整数，执行的是算术右移，高位补符号位值，执行指令 “SHR R1” 后，R1 的内容为 $1111111011111111{\rm B}={\rm FEFFH}$ 。
> 
> (2) 因为计算机采用 5 段流水方式执行指令，有连续的 4 条指令进入流水线，在其执行过程中没有发生任何阻塞，执行过程如下图所示，至少需要 4+(5-1)=8 个时钟周期。
> 
> ![](https://pica.zhimg.com/v2-5159f92881d52045c6e6696e0137a068_r.jpg)
> 
> (3) I3 的 ID 段被阻塞的原因为 I3 与 I1 和 I2 都存在数据相关，需要等到 I1 和 I2 将结果分别写会寄存器 R1 和 R2 后，I3 才能读这些寄存器中内容，即写后读数据相关。因为流水线采用 “按序发射，按序完成” 方式，没有采用转发技术处理数据相关，所以读某临界资源相关的操作指令的 ID 要在写该临界资源相关的操作指令的 WB 之后执行，I3 的 ID 段被阻塞。
> 
> I4 被阻塞的原因为前一条指令 I3 在 ID 段被阻塞，流水线采用 “按序发射，按序完成” 方式，所以 I4 的 IF 段被阻塞。
> 
> (4) x=x*2+a 对应的指令序列为
> 
> $\begin{array}{cc} \text{I}_1&\text{LOAD R1, [x]}\\ \text{I}_2&\text{LOAD R2, [a]}\\ \text{I}_3&\text{ADD R1, R1 或 SHL R1}\\ \text{I}_4&\text{ADD R1, R2}\\ \text{I}_5&\text{STORE R2, [x]} \end{array}$
> 
> 观察该指令序列，I3 和 I1 存在数据相关，I4 和 I2 存在数据相关，I4 和 I3 存在数据相关，I5 和 I4 存在数据相关。
> 
> 可得该指令序列在流水线中的执行过程示意图如下：
> 
> ![](https://pica.zhimg.com/v2-8063763405624fae881f30b05f5893aa_r.jpg)