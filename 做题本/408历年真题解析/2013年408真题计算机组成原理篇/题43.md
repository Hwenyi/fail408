---
publish: true
tags: 
aliases: 
finished: true
title: 题43
created: "2024-11-21 06:43"
updated: "2024-11-21 07:40"
---
## 题43
### 题目
> [!question]+
> （9 分）
> 
> 某 32 位计算机，CPU 主频为 800MHz，Cache 命中时的 CPI 为 4，Cache 块大小为 32 字节；主存采用 8 体交叉存储方式，每个体的存储字长为 32 位、存储周期是 40ns；存储器总线宽度为 32 位，总线时钟频率为 200MHz，支持突发传送总线事务。每次读突发传送总线事务的过程包括：送首地址和命令、存储器准备数据、传送数据。每次突发传送 32 字节，传送地址或者 32 位数据均需要一个总线时钟周期。请回答下列问题，要求给出理由或者计算过程。
> 
> (1) CPU 和总线的时钟周期各是多少？总线的带宽（即最大数据传输率）为多少？
> 
> (2) Cache 缺失时，需要用几个读突发传送总线事务来完成一个主存块的读取？
> 
> (3) 存储器总线完成一次读突发传送总线事务所需的时间是多少？
> 
> (4) 若程序 BP 执行过程中，共执行了 100 条指令，平均每条指令需要 1.2 次访存，Cache 缺失率是 5%，不考虑替换等开销，则 BP 的 CPU 执行时间是多少？
### 解
> [!done]+
> (1) 第一问，因为 CPU 主频为 800MHz，所以 CPU 的时钟周期为 1/800MHz=1.25ns。
> 
> 第二问，因为总线时钟频率为 200MH，所以总线时钟周期为 1/200MHz=5ns。
> 
> 因为存储器总线宽度为 32bit=4B，所以总线带宽为 4B×200MHz=800MB/s 或 4B/5ns=800MB/s。
> 
> (2) 因为总线支持突发传送总线事务，每次突发传送 32 字节，Cache 块大小是 32B，需要 32B/32B=1 次突发传送，所以需要一个读突发传送总线事务来完成一个主存块的读取。
> 
> (3) 每次读突发传送总线事务的过程包括：送首地址和命令、存储器准备数据、传送数据。
> 
> 传输地址时间：因为传送地址需要一个总线时钟周期，即 5ns。
> 
> 存储器准备数据时间：每次突发传送 32 字节，存储器总线宽度为 32 位，所以总线需要分 32B/32bit=8 次传送，因为主存采用 8 体交叉（默认低位交叉）存储方式，即可以用流水线方式处理，存储周期是 40ns，每隔一个总线时钟周期启动一个流水线段，8 个流水线段需要时间为 40ns+(8-1)×5ns=75ns。
> 
> 传送数据时间：传送 32 位数据需要一个总线时钟周期，即 5ns。
> 
> ![](https://picx.zhimg.com/v2-1c6298c14a112569588275d006cade5b_r.jpg)
> 
> 总共需要时间为 5ns+75ns+5ns=85ns。
> 
> (4) 无论数据是否存放到 Cache 中，CPU 都是先访问 Cache， 只有当 Cache 中找不到数据时，才会去访问内存，并把内存中的数据读⼊到 Cache 中，CPU 再从 CPU Cache 读取数据。
> 
> 方法一：BP 的 CPU 执行时间包括 Cache 命中时的指令执行时间和 Cache 缺失时带来的额外开销。
> 
> 指令访问 Cache 执行时间：BP 共执行了 100 条指令，无论数据是否存放到 Cache 中，CPU 最终都要从 CPU Cache 读取数据，因为 Cache 命中时的 CPI 为 4，即每条指令访问 Cache 的 CPI 为 4，CPU 的时钟周期为 1.25ns，所以从指令访问 Cache 执行时间是 100×4×1.25ns=500ns。
> 
> 指令访问主存执行时间：因为 BP 共执行了 100 条指令，平均每条指令需要 1.2 次访存，Cache 缺失率是 5%，Cache 缺失率 = Cache 缺失次数 / 访存次数，访存次数 = 指令数 × 平均每条指令需要的访存次数，（注意，不同指令需要的访存次数不一定相同。）得到 Cache 缺失次数 = 指令数 × 平均每条指令需要的访存次数 ×Cache 缺失率 = 1.2×100×5%=6。缺失后需要加载一个 Cache 块，Cache 块大小为 32 字节，每次突发传送 32 字节，缺失后需要 32B/32B=1 次突发传送，根据 (3) 的计算结果，一次读突发传送总线事务所需的时间是 85ns，所以指令执行过程中因 Cache 缺失造成的额外开销 = Cache 缺失次数 × 每次 Cache 缺失需要的突发传送次数 × 每次突发传送总线事务所需的时间 = 6×1×85ns=510ns。
> 
> BP 的 CPU 执行时间 = 指令访问 Cache 执行时间 + 指令访问主存执行时间 = 500ns+510ns=1010ns。
> 
> 方法二：BP 的 CPU 执行时间包括 Cache 直接命中时的指令执行时间和 Cache 缺失时的指令执行时间。
> 
> Cache 直接命中时的指令执行时间：BP 共执行了 100 条指令，Cache 缺失率是 5%，Cache 命中时的 CPI 为 4，即每条指令访问 Cache 的 CPI 为 4，CPU 的时钟周期为 1.25ns，所以 Cache 直接命中时的指令执行时间是 100×4×1.25ns×(1-5%)=475ns。
> 
> Cache 未能直接命中时的指令执行时间：因为 BP 共执行了 100 条指令，平均每条指令需要 1.2 次访存，Cache 缺失率是 5%，Cache 缺失率 = Cache 缺失次数 / 访存次数，访存次数 = 指令数 × 平均每条指令需要的访存次数，（注意，不同指令需要的访存次数不一定相同。）得到 Cache 缺失次数 = 指令数 × 平均每条指令需要的访存次数 ×Cache 缺失率 = 1.2×100×5%=6。缺失后需要加载一个 Cache 块，Cache 块大小为 32 字节，每次突发传送 32 字节，缺失后需要 32B/32B=1 次突发传送，根据 (3) 的计算结果，一次读突发传送总线事务所需的时间是 85ns，所以指令执行过程中因 Cache 缺失造成的额外开销 = Cache 缺失次数 × 每次 Cache 缺失需要的突发传送次数 × 每次突发传送总线事务所需的时间 = 6×1×85ns=510ns。然后重新访问 Cache 块加载数据，Cache 命中时的 CPI 为 4，重新访问 Cache 块加载数据的时间是 100×4×1.25ns×5%=25ns。总开销 510ns+25ns=535ns。
> 
> BP 的 CPU 执行时间 = Cache 直接命中时的指令执行时间 + Cache 未能直接命中时的指令执行时间 = 475ns+535ns=1010ns。
> 
> 注：实际上，在现代计算机中，访问 cache 未命中，无需要再访问一次 Cache，因为再访问一次 Cache 相比直接将获取到的数据直接送入 CPU 开销更大。
> 
> 根据袁春风《计算机组成与系统结构（第 2 版）》7.6.2 Cache 的基本工作原理，带 Cache 的 CPU 访存操作过程如下：
> 
> ![](https://pic3.zhimg.com/v2-364712e25e3c26a34950fb4cc37fd850_r.jpg)
> 
> 评：关于问题 [Cpu 访问 cache 未命中，是否还需要访问一次 cache? ?](https://www.zhihu.com/question/419394566/answer/1829405172)
> 
> 参考知友的的所有回答和袁春风《计算机组成与系统结构》，在现代计算机体系结构中，Cache 未命中后无需再次访问 Cache。但根据官方答案，无论数据是否存放到 Cache 中，CPU 都是先访问 Cache， 只有当 Cache 中找不到数据时，才会去访问内存，并把内存中的数据读⼊到 Cache 中，CPU 再从 CPU Cache 读取数据。
> 
> 注：“主存采用 8 体交叉存储方式” 默认为 “主存采用 8 体低位交叉存储方式”，类似的还有 2015 年题 18。低位交叉存储方式：在不改变每个模块存储周期的前提下，采用流水线方式并行存取，提高存储器的带宽。若模块字长等于数据总线宽度，模块存取一个字长存取周期为 $T$ ，总线传送周期为 $r$ ，则交叉存储度为 $m=T/r$ ，交叉存储度必须小于或等于交叉模块数，连续存取 $m$ 个字所需时间为 $T+(m-1)r$ 。