---
publish: true
tags: 
aliases: 
finished: true
title: 题46
created: "2024-11-21 07:25"
updated: "2024-11-21 07:40"
---
## 题46
### 题目
> [!question]+
> （8 分）
> 
> 某 32 位系统采用基于二级页表的请求分页存储管理方式，按字节编址，页目录项和页表项长度均为 4 字节，虚拟地址结构如下所示。
> 
> 页目录号（位）页号（位）页内偏移（位）$\begin{array}{|c|}\hline \text{页目录号（10位）}&\text{页号（10位）}&\text{页内偏移（12位）}\\\hline \end{array}$
> 
> 某 C 程序中数组 `a[1024][1024]` 的起始虚拟地址为 1080 0000H，数组元素占 4 字节，该程序运行时，其进程的页目录起始物理地址为 0020 1000H，请回答下列问题。
> 
> (1) 数组元素 `a[1][2]` 的虚拟地址是什么？对应的页目录号和页号分别是什么？对应的页目录项的物理地址是什么？若该目录项中存放的页框号为 00301H，则 `a[1][2]` 所在页对应的页表项的物理地址是什么？
> 
> (2) 数组 a 在虚拟地址空间中所占区域是否必须连续？在物理地址空间中所占区域是否必须连续？
> 
> (3) 已知数组 a 按行优先方式存放，若对数组 a 分别按行遍历和按列遍历，则哪一种遍历方式的局部性更好？
### 解
> [!done]+
> (1) 第一问。数组元素 `a[i][j]` 的虚拟地址 = 数组 a 的起始虚拟地址 +(i× 数组 a 的行数 + j)× 数组元素占地址单元数。数组 `a[1024][1024]` 的起始虚拟地址为 1080 0000H，行数为 1024，每个数组元素占 4 字节，按字节编址，每个数组元素占 4 个地址单元。数组元素 `a[1][2]` 的虚拟地址 = 1080 0000H + (1024×1+2)×4=1080 1008H 。
> 
> 第二问。数组元素 `a[1][2]` 的虚拟地址 1080 1008H =$\underbrace{0001 0000 10}_{\text{页目录号}} \underbrace{00 0000 0001}_{\text{页号}}\underbrace{0000 0000 1000}_{\text{页内偏移量}}$B，对应的页目录号是 0001000010B=042H，页号是 00 0000 0001B=001H。
> 
> 第三问。因为该程序运行时，其进程的页目录起始物理地址为 0020 1000H，页目录项长度为 4 字节，按字节编址，每个页目录项占 4 个地址单元，数组元素 `a[1][2]` 所在页目录号为 042H，所以对应的页目录项的物理地址是 0020 1000H+4×042H=0020 1108H。
> 
> 第四问。因为该目录项中存放的页框号为 00301H，页表项长度为 4 字节，按字节编址，每个页表项占 4 个地址单元，数组元素 `a[1][2]` 对应页号是 001H，页内偏移为 4×001H=004H，根据虚拟地址结构，页内偏移占 12 位，拼接页框号 00301H 和页内偏移 004H 得到 `a[1][2]` 所在页对应的页表项的物理地址为 00301004H。
> 
> (2) 第一问。因为数组要求支持随机访问，所以数组 a 在虚拟地址空间中所占区域必须连续。
> 
> 第二问。因为系统采用请求分页存储管理方式，操作系统使用地址映射技术将虚拟地址映射到物理地址，这种映射关系可以是灵活的，不一定要求数组 a 在物理内存中占据连续的区域。所以数组 a 在物理地址空间中所占区域不必连续。
> 
> (3) 因为数组 a 在虚拟地址空间连续存放，系统采用请求分页存储管理方式，操作系统使用地址映射技术将虚拟地址映射到物理地址，数组 a 在同一页框中的元素连续存放，所以当访问方式和数组存放方式一致时，对数组遍历局部性更好。因为数组 a 按行优先方式存放，所以对数组 a 按行遍历局部性更好。