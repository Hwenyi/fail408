---
publish: true
tags: 
aliases: 
finished: true
title: 题43
created: "2024-11-21 07:19"
updated: "2024-11-21 07:40"
---
## 题43
### 题目
> [!question]+
> （8 分）
> 
> 假定计算机的主频为 500MHz，CPI 为 4。现有设备 A 和 B，其数据传输率分别为 2MBps 和 40MBps，对应 I/O 接口中各有一个 32 位数据缓冲寄存器。请回答下列问题，要求给出计算过程。
> 
> (1) 若设备 A 采用定时查询 I/O 方式，每次输入 / 输出都至少执行 10 条指令。设备 A 最多间隔多长时间查询一次才能不丢失数据？CPU 用于设备 A 输入 / 输出的时间占 CPU 总时间的百分比至少是多少？
> 
> (2) 在中断 I/O 方式下，若每次中断响应和中断处理的总时钟周期数至少为 400，则设备 B 能否采用中断 I/O 方式？为什么？
> 
> (3) 若设备 B 采用 DMA 方式，每次 DMA 传送的数据块大小 1000B，CPU 用于 DMA 预处理和后处理的总时钟周期数为 500，则 CPU 用于设备 B 输入 / 输出的时间占 CPU 总时间的百分比最大是多少？
### 解
> [!done]+
> (1) 第一问。程序定时向缓存端口查询数据，由于缓存端口大小有限，必须在传输完端口大小的数据时访问端口，以防止部分数据没有被及时读取而丢失。设备 A 的数据传输率为 2MBps，设备 A 准备 32 位数据所用时间为 32bit/2MBps=4B/2MBps=2μs，所以最多每隔 2μs 必须查询一次。
> 
> 第二问。
> 
> 方法一：通过时间计算
> 
> 因为计算机的主频为 500MHz，时钟周期为 2ns，CPI 为 4，平均执行一条指令需要 2ns×4=8ns，每次输入 / 输出都至少执行 10 条指令，所以每次输入 / 输出需要 CPU 时间为 8ns×10=80ns，又因为根据第一问，设备 A 最多每隔 2μs 必须查询一次，所以 CPU 用于设备 A 输入输出的时间占 CPU 总时间的百分比至少是 80ns/2μs=4%。
> 
> 方法二：通过频率计算
> 
> 因为计算机 CPI 为 4，每次输入 / 输出都至少执行 10 条指令，所以每次输入 / 输出都至少需要 4×10=40 个时钟周期，又因为根据第一问，设备 A 最多每隔 2μs 必须查询一次，即每秒的查询次数至少是 1s/2μs=0.5M，所以 CPU 每秒用于设备 A 输入 / 输出的时钟周期数至少为 40×0.5M=20M，又因为计算机的主频为 500MHz，即每秒有 500M 个时钟周期，所以 CPU 用于设备 A 输入输出的时间占 CPU 总时间的百分比至少是 20M/500M=4%。
> 
> (2) 方法一：通过时间计算
> 
> 因为计算机的主频为 500MHz，时钟周期为 2ns，在中断 I/O 方式下，若每次中断响应和中断处理的总时钟周期数至少为 400，则每次中断响应和中断处理的时间至少为 2ns×400=800ns。这时只需判断设备 B 准备 32 位数据要多久，如果准备数据的时间小于中断响应和中断处理的时间，那么数据就会被刷新、造成丢失。设备 B 的数据传输率为 40MBps，设备 B 准备 32 位数据所用时间为 32bit/40MBps=4B/40MBps=100ns<800ns。因此，设备 B 不适合采用中断 I/O 方式。
> 
> 方法二：通过频率计算
> 
> 因为计算机的主频为 500MHz，即每秒有 500M 个时钟周期，在中断 I/O 方式下，若每次中断响应和中断处理的总时钟周期数至少为 400，计算机的处理中断的频率至多为 500MHz/400=1.25MHz。这时只需计算设备 B 可以多少次将数据送入 32 位数据缓冲寄存器的频率。如果设备 B 可以多少次将数据送入 32 位数据缓冲寄存器的频率大于计算机的处理中断的频率，那么数据就会被刷新、造成丢失。设备 B 的数据传输率为 40MBps，设备 B 可以多少次将数据送入 32 位数据缓冲寄存器的频率为 40MBps/32bit=40MBps/4B=10MHz>1.25MHz。因此，设备 B 不适合采用中断 I/O 方式。
> 
> (3) 在 [[DMA]] 方式中，只有预处理和后处理需要 CPU 处理，数据的传送过程是由 DMA 控制。
> 
> 方法一：通过时间计算
> 
> 因为计算机的主频为 500MHz，时钟周期为 2ns，CPU 用于 DMA 预处理和后处理的总时钟周期数为 500，所以每次 DMA 预处理和后处理的时间为 2ns×500=1μs。设备 B 每次 DMA 传送的数据块大小 1000B，设备 B 的数据传输率为 40MBps，设备每次 DMA 传送的时间（包含 DMA 预处理和后处理的时间）为 1000B/40MBps=25μs，CPU 用于设备 B 输入 / 输出的时间占 CPU 总时间的百分比最大是 1μs/25μs=4%。
> 
> 方法二：通过频率计算
> 
> 设备 B 每次 DMA 传送的数据块大小 1000B，设备 B 的数据传输率为 40MBps，设备 B 每秒 DMA 次数至多为 40MB/1000B=0.04M，CPU 用于 DMA 预处理和后处理的总时钟周期数为 500，CPU 每秒用于设备 B 输入 / 输出的时钟周期至多为 0.04M×500=20M，因为计算机的主频为 500MHz，即每秒有 500M 个时钟周期，CPU 用于设备 B 输入 / 输出的时间占 CPU 总时间的百分比最大是 20M/500M=4%。