---
publish: true
tags: 
aliases: 
finished: true
title: 题44
created: "2024-11-21 07:19"
updated: "2024-11-21 07:40"
---
## 题44
### 题目
> [!question]+
> （15 分）
> 
> 某计算机采用页式虚拟存储管理方式，按字节编址。CPU 进行存储访问的过程如题 44 图所示。
> 
> ![](https://pic4.zhimg.com/v2-73206251e9752bf01f43d1460d05cdc9_r.jpg)
> 
> 根据题 44 图回答下列问题。
> 
> (1) 主存物理地址占多少位？
> 
> (2) TLB 采用什么映射方式？TLB 用 SRAM 还是 DRAM 实现？
> 
> (3) Cache 采用什么映射方式？若 Cache 采用 LRU 替换算法和回写（Write Back）策略，则 Cache 每行中除数据（Data）、Tag 和有效位外，还应有哪些附加位？Cache 总容量是多少？Cache 中有效位的作用是什么？
> 
> (4) 若 CPU 给出的虚拟地址为 0008C040H，则对应的物理地址是多少？是否在 Cache 中命中？说明理由。若 CPU 给出的虚拟地址为 0007C260H，则该地址所在主存块映射到的 Cache 组号是多少？
### 解
> [!done]+
> (1) 方法一：观察 TLB 和虚拟地址
> 
> 观察 TLB 中实页号项，例如 F800H=1111 1000 0000 0000B，最高位为 1，没有填充 0，可知实页号占 16 位，观察虚拟地址中页内地址项，可知页内地址占 12 位，物理地址格式为 $\begin{array}{|c|c|}\hline \text{实页号}&\text{页内地址}\\\hline\end{array}$ ，可得物理地址占 16+12=28 位。为了防止实页号项高位被填充 0，采用下面一种方法更加合适。
> 
> 方法二：观察物理地址映射到 Cache 后的地址
> 
> 物理地址映射到 Cache 后的地址位数不变，观察映射到 Cache 后的地址结构，可得物理地址占 20+3+5=28 位。
> 
> (2) 第一问。TLB 采用全相联映射，可以把页表内容调入任一块空 TLB 项中，TLB 中每项都有一个比较器，没有映射规则，只要空闲就行。
> 
> 第二问。TLB 采用静态存储器 SRAM，读写速度快，但成本高，多用于容量较小的高速缓冲存储器。可以用 Cache 类比 TLB，Cache 是主存的缓存，TLB 是页表的缓存，两者都要求读写速度快，Cache 采用静态存储器 SRAM，因此 TLB 采用静态存储器 SRAM。
> 
> (3) 第一问。根据题 44 图，Cache 中每组有两行，采用 2 路组相联映射方式。
> 
> 第二问。若 Cache 采用 LRU 替换算法和回写（Write Back）策略，则 Cache 每行中除数据（Data）、Tag 和有效位外，还应有替换算法控制位和一致性维护位。
> 
> 考虑 $n$ 路组相联并采用 LRU 替换算法，需要记录若某组不命中时，则按照 LRU 替换算法规则查找该组中最久未被访问的一行进行替换，组内每一行都需要记录一个和组内其它行不同的秩，用来表示该行的未被访问的时间排名，每组最多有 $n$ 个秩，范围为 $0\sim n-1$ ，需要 $\log n$ 位来表示，所以 LRU 需要的替换算法控制位数为 $\lceil \log n\rceil$ ，本题为 2 路组相连，所以每行需要 $\lceil \log 2\rceil=1$ 位替换算法控制位。
> 
> 不同替换算法需要的替换算法控制位总结如下：
> 
> $$\begin{array}{|c|}\hline \text{替换算法}&\text{替换算法含义}&\text{替换算法控制位内容}&\text{替换算法控制位数}\\\hline \text{RAND}&\text{随机选择字块进行替换}&&0\\ \text{FIFO}&\text{选择最早调入的字块进行替换}&\text{调入时刻顺序排名}&\lceil \log n\rceil\\ \text{LRU}&\text{选择最久未被访问的字块进行替换}&\text{未被访问时间排名}&\lceil \log n\rceil\\ \text{LFU}&\text{选择最近一段时间最少使用的字块进行替换}&\text{最近一段时间访问次数}&计数器位数\\\hline \end{array}$$
> 
> 注：这里对王道进行勘误，“所以每行（或每组）需要 1 位替换 LRU 位” 应该修改为 “所以每行需要 1 位替换 LRU 位”。
> 
> 因为采用回写策略，所以每行有 1 位脏位，根据脏位判断数据是否被更新，如果脏位为 1 则需要写回内存。
> 
> 不同写策略需要的脏位位数总结如下：
> 
> $\begin{array}{|c|}\hline \text{写策略}&\text{脏位位数}\\\hline \text{全写法}&0\\ \text{回写法}&1\\\hline \end{array}$
> 
> 第三问。Cache 组相联映射的地址结构中，主存字块标记占 20 位，组号占 3 位，Cache 中有 $2^3=8$ 组，每组有两行，Cache 中有 8×2=16 行，块内地址占 5 位，计算机按字节编址，Cache 块大小为 $2^5$×1B=32B。
> 
> Cache 每行标记位数 = 主存字块标记位数 + 有效位位数 + 替换算法控制位位数 + 脏位位数 =(20+1+1+1)bit=23bit。
> 
> Cache 每行数据位数 = 32B=32×8bit=256bit。
> 
> Cache 总容量 =(Cache 每行标记位数 + Cache 每行数据位数)×Cache 行数 =(23bit+256bit)×16=558B。
> 
> Cache 总容量是 558 字节。
> 
> 第四问。Cache 中有效位用来指出所在 Cache 行中的信息是否有效。即用于指示 Cache 行中的数据是否有效或者说是为了标识 Cache 行是否包含了当前正在被请求的数据。当有效位被设置为有效（即设置为 1）时，表示 Cache 行中的数据是最新的、有效的，并且可用于响应对应的读取请求。相反，当有效位被设置为无效（即设置为 0）时，表示 Cache 行中的数据无效，无法被使用，需要重新从主存或其他更低层级的缓存中获取最新的数据。
> 
> (4) 第一问。虚拟地址格式为 $\begin{array}{|c|c|}\hline \text{虚页号}&\text{页内地址}\\\hline\end{array}$ ，物理地址格式为 $\begin{array}{|c|c|}\hline \text{实页号}&\text{页内地址}\\\hline\end{array}$ ，利用虚拟地址的虚页号部分去查找 TLB 表（缺失时从页表调入），将实页号取出后和虚拟地址的页内地址拼接，就形成了物理地址。
> 
> 虚拟地址 $\rm \underbrace{0008C}_{\text{虚页号}}\,\underbrace{040}_{\text{页内地址}} {\rm H}$ ，查找 TLB 表中 Tag 为 0008CH 的项，有效位为 1，实页号为 0040H，得到 0008C040H 所在的物理地址为 $\underbrace{0040}_{\text{实页号}}\,\underbrace{040}_{\text{页内地址}} {\rm H}$ 。
> 
> 第二问。Cache 组相联映射的地址格式为 $\begin{array}{|c|c|c|}\hline \text{主存字块标记}&\text{组号}&\text{块内地址}\\\hline\end{array}$ ，物理地址高 20 位对应主存字块标记，所以物理地址 $\underbrace{00400}_{\text{主存字块标记}}40$ H 的主存字块标记为 00400H，查 Cache 表表中 Tag 为 00400H 的项，左边一个存在 Tag 为 00400H 的项，但有效位为 0，右边一个不存在 Tag 为 00400H 的项，所以访问 Cache 不命中。
> 
> 第三问。因为物理地址的低 12 位与虚拟地址低 12 位相同，对于虚拟地址为 0007C260H，低 12 位为 260H=0010 0110 0000B 。根据物理地址的结构，物理地址的后八位 01100000B 的前三位 011B 是组号，因此该地址所在的主存映射到 Cache 组号为 011B=3。