---
publish: true
tags: 
aliases: 
finished: true
title: 题43
created: "2024-11-21 06:40"
updated: "2024-11-21 07:40"
---
## 题43
### 题目
> [!question]+
> （11 分）
> 
> 某计算机字长为 16 位，主存地址空间大小为 128KB，按字编址，采用单字长指令格式，指令各字段定义如下图所示。
> 
> ![](https://img.hwenyi.live/202412041840556.webp)
> 
> 转移指令采用相对寻址，相对偏移量用补码表示，寻址方式定义如下：
> 
> $$\begin{array}{|c|}\hline \text{Ms/Md}&\text{寻址方式}&\text{助记符}&\text{含义}\\\hline \text{000B}&\text{寄存器直接}&\text{Rn}&\text{操作数=(Rn)}\\ \text{001B}&\text{寄存器间接}&\text{(Rn)}&\text{操作数=((Rn))}\\ \text{010B}&\text{寄存器间接、自增}&\text{(Rn)+}&\text{操作数=((Rn)), (Rn)+1→Rn}\\ \text{011B}&\text{相对}&\text{D(Rn)}&\text{转移目标地址=(PC)+(Rn)}\\ \hline\end{array}$$
> 
> 注：(X) 表示有存储器地址 X 或寄存器 X 的内容。
> 
> 请回答下列问题:
> 
> (1) 该指令系统最多可有多少条指令？该计算机最多有多少个通用寄存器？存储器地址寄存器（MAR）和存储器数据寄存器（MDR）至少各需要多少位？
> 
> (2) 转移指令的目标地址范围是多少？
> 
> (3) 若操作码 0010B 表示加法操作（助记符为 ADD），寄存器 R4 和 R5 的编号分别为 100B 和 101B，R4 的内容为 1234H，R5 的内容为 5678H，地址 1234H 中的内容为 5678H，地址 5678H 中的内容为 1234H，则汇编语句 “ADD (R4),(R5)+”（逗号前为源操作数，逗号后为目的操作数）对应的机器码是什么（用十六进制表示）？该指令执行后，哪些寄存器和存储单元的内容会改变？改变后的内容是什么？
### 解
> [!done]+
> (1) 操作码占 4 位，则该指令系统最多可有 $2^4=16$ 条指令。操作数占 6 位，其中寻址方式占 3 位，寄存器编号占 3 位，因此该计算机最多有 $2^3=8$ 个通用寄存器。主存地址空间大小为 128KB，按字编址，字长为 16 位 = 2B，共有 $\rm 128KB/2B = 2^{16}$ 个存储单元，因此 MAR 至少 $\log 2^{16}=16$ 位，因为字长为 16 位，故 MDR 至少为 16 位。
> 
> (2) 因为转移指令采用相对寻址，查表得，转移目标地址 =(PC)+(Rn)，一般
> 
> 寄存器位数为字长，即 16 位，相对偏移量用补码表示，偏移范围为 $-2^{15}\sim 2^{15}-1$ ，根据 (1) 的计算结果，主存地址范围大小为 $2^{16}$ ，主存地址从 0 开始，地址范围为 $0\sim 2^{16}-1$ ，即 0000H~FFFFH，这里没有给出初始 PC 的值，默认可以取整个主存地址空间，偏移后不能超出主存地址空间，所以转移指令的目标地址范围为 0000H~FFFFH。
> 
> 如果给定了初始 PC 的值 $x$ ，首先要执行 (PC)+1→PC，PC 自增一个指令字长的字长数，即自动指向下一条指令所在地址，本题中计算机采用单字长指令格式，所以偏移为 1，转移指令的目标地址范围为 $\max\{0,x+1-2^{15}\}\sim\min\{2^{16}-1,x+1+2^{15}-1\}$ ，即 $\max\{0,x+1-2^{15}\}\sim\min\{2^{16}-1,x+2^{15}\}$ 。
> 
> (3) 汇编语句 “ADD (R4),(R5)+” 采用助记符表示，根据助记符项查表可得：
> 
> $\begin{array}{|c|} \hline\text{字段}&\text{OP}&\text{Ms}&\text{Rs}&\text{Md}&\text{Rd}\\\hline \text{内容}&\text{0010}&\text{001}&\text{100}&\text{010}&\text{101}\\\hline \text{说明}&\text{ADD}&\text{寄存器间接}&\text{R4}&\text{寄存器间接、自增}&\text{R5}\\\hline \end{array}$
> 
> 该指令的机器码为 0010 0011 0001 0101B=2315H。
> 
> 源操作数通过寄存器 R4 间接寻址获取，即 ((R4))，目的操作数通过寄存器 R5 间接寻址获取，即 ((R5))，然后自增，即 (R5)+1→R5。本题降低了难度，表格已经给出了含义一栏，如果去掉含义，需要通过寻址方式的定义写出含义一栏的表达式。
> 
> - 寄存器 R 寻址：有效地址 EA = R，有效地址内容 (EA) = (R)。
> - 寄存器 R 间接（一次）寻址：有效地址 EA = (R)，有效地址内容 (EA) = ((R))。
> 
> 首先执行 ((R4))+((R5))→((R5))，其中 ((R4))=(1234H)=5678H，((R5))=(5678H)=1234H，((R4))+((R5))→((R5))，即 5678H+1234H→(5678H)，即 68ACH→(5678H)。
> 
> 然后执行 (R5)+1→R5，即 5678H+1H→R5，即 5679H→R5。
> 
> 执行该指令后，寄存器 R5 内容变为 5679H，存储单元 5678H 内容变为 68ACH。