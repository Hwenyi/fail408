---
publish: true
tags: 
aliases: 
finished: true
title: 题44
created: "2024-11-21 07:26"
updated: "2024-11-21 07:40"
---
## 题44
### 题目
> [!question]+
> （10 分）
> 
> 假定主存地址为 32 位，按字节编址，指令 Cache 和数据 Cache 与主存之间均采用 8 路组相联映射方式，直写（WriteThrough）写策略和 LRU 替换算法，主存块大小为 64B，数据区容量各为 32KB。开始时 Cache 均为空。请回答下列问题。
> 
> (1) Cache 每一行中标记（Tag）、LRU 位各占几位？是否有修改位？
> 
> (2) 有如下 C 语言程序段：
> 
> ```cpp
> for(k = 0; k < 1024; k++)
>     s[k] = 2 * s[k];
> ```
> 
> 若数组 s 及其变量 k 均为 int 型，int 型数据占 4B，变量 k 分配在寄存器中，数组 s 在主存中的起始地址为 008000C0H，则该程序段执行过程中，访问数组 s 的数据 Cache 缺失次数为多少？
> 
> (3) 若 CPU 最先开始的访问操作是读取主存单元 00010003H 中的指令，简要说明从 Cache 中访问该指令的过程，包括 Cache 缺失处理过程。
### 解
> [!done]+
> (1) Cache 采用 8 路组相联映射方式，组相联映射格式为$\begin{array}{|c|c|c|}\hline \text{主存字块标记}&\text{组号}&\text{块内地址}\\\hline \end{array}$。主存块大小为 64B= $2^6$B，按字节编址，主存地址低 6 位为块内地址，数据区容量各为 32KB，行数为 32KB/64B=$2^9$，采用 8 路组相联，组数为$2^9/8=2^6$，主存地址中间 6 位为 Cache 组号，主存地址为 32 位，主存地址中高 32-6-6=20 位为标记，8 路组相联 LRU 位占 $\log 8=3$ 位，采用直写方式，故没有修改位。
> 
> (2) 因为数组 s 的起始地址 008000C0H= $\rm\underbrace{0000 0000 1000 0000 0000}_{\text{主存字块标记}}\underbrace{000011}_{\text{组号}}\underbrace{000000}_{\text{块内地址}}B$ ，块内地址为 000000B=0，所以 s 位于一个主存块开始处，需要访问 1024 个数组元素，每个数组元素类型为 int，占 4B，主存块大小为 64B，1024 个数组元素占 1024×4B/64B=64 个主存块。执行程序段过程中，观察 `s[k]=2*s[k]`，每个数组元素都需要读、写各 1 次，主存块大小为 64B，每访问一个主存块（包含 64B/4B=16 个数组元素）产生一次 Cache 缺失，每个主存块会访问 16×(1+1)=32 次。总共需要访问 64 个主存块，产生 64×1=64 次 Cache 缺失。所以该程序段执行过程中，访问数组 s 的数据 Cache 缺失次数为 64。
> 
> (3)
> 
> 00010003H= $\rm\underbrace{00000000000000010000}_{\text{主存字块标记}}\underbrace{000000}_{\text{组号}}\underbrace{000011}_{\text{块内地址}}B$ ，根据主存地址划分可知，组索引为 0，故该地址所在主存块被映射到指令 Cache 组 0；因为 Cache 初始为空，所有 Cache 行的有效位均为 0，所以 Cache 访问缺失。此时，将该主存块取出后存入指令 [[cache]] 组 0 的某一行，并将主存地址高 20 位（00010H）填入该行标记字段，设置有效位，修改 LRU 位，最后根据块内地址 000011B **从该行中取出相应内容**。
> 
> 注：实际上，在现代计算机中，访问 cache [[不命中|未命中]]，无需要再访问一次 Cache，因为再访问一次 Cache 相比直接将获取到的数据直接送入 CPU 开销更大。
> 
> 根据袁春风《计算机组成与系统结构（第 2 版）》7.6.2 Cache 的基本工作原理，带 Cache 的 CPU 访存操作过程如下：
> 
> ![](https://pic3.zhimg.com/v2-364712e25e3c26a34950fb4cc37fd850_r.jpg)
> 
> 问题 [Cpu 访问 cache 未命中，是否还需要访问一次 cache? ?](https://www.zhihu.com/question/419394566/answer/1829405172)
> 
> 参考知友的的所有回答和袁春风《计算机组成与系统结构》，在现代计算机体系结构中，Cache [[不命中|未命中]]后无需再次访问 [[cache]]。**但**根据官方答案，无论数据是否存放到 Cache 中，CPU 都是先访问 Cache， 只有当 Cache 中找不到数据时，才会去访问内存，并把内存中的数据读⼊到 Cache 中，CPU 再从 Cache 读取数据。