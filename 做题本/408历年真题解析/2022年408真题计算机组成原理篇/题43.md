---
publish: true
tags: 
aliases: 
finished: true
title: 题43
created: "2024-11-21 07:27"
updated: "2024-11-21 07:40"
---
## 题43
### 题目
> [!question]+
> （15 分）
> 
> 某 CPU 中部分数据通路如图所示，其中，GPRs 为通用寄存器组；FR 为标志寄存器，用于存放 ALU 产生的标志信息；带箭头虚线表示控制信号，如控制信号 Read、Write 分别表示主存读、主存写，MDRin 表示内部总线上数据写入 MDR，MDRout 表示 MDR 的内容送内部总线。
> 
> ![](https://pic2.zhimg.com/v2-61ed08eff75eb2ecc26308204dd839ad_r.jpg)
> 
> (1) ALU 的输入端 A、B 及输出端 F 的最高位分别为 $\rm A_{15}$ 、 $\rm B_{15}$ 及 $\rm F_{15}$ ，FR 中的符号标志和溢出标志分别为 SF 和 OF，则 SF 的逻辑表达式是什么？A 加 B、A 减 B 时 OF 的逻辑表达式分别是什么？要求逻辑表达式的输入变量为$\rm A_{15}$ 、 $\rm B_{15}$ 及 $\rm F_{15}$ 。
> 
> (2) 为什么要设置暂存器 Y 和 Z？
> 
> (3) 若 GPRs 的输入端 rs、rd 分别为所读、写的通用寄存器的编号，则 GPRs 中最多有多少个通用寄存器？rs 和 rd 来自图中的哪个寄存器？已知 GPRs 内部有一个地址译码器和一个多路选择器，rd 应该连接地址译码器还是多路选择器？
> 
> (4) 取指令阶段（不考虑 PC 增量操作）的控制信号序列是什么？若从发出主存读命令到主存读出数据并传送到 MDR 共需 5 个时钟周期，则取指令阶段至少需要几个时钟周期？
> 
> (5) 图中控制信号由什么部件产生？图中哪些寄存器的输出信号会连到该部件的输入端？
### 解
> [!done]+
> (1) 第一问。符号标志 SF 表示输出结果 F 的正负性，F 的最高位（符号位）为 $\rm F_{15}$ ，因此 $\rm SF=F_{15}$ 。
> 
> 第二问。A 加 B 时，A+B→F。若 A 和 B 都为负且 F 为正，则溢出，或者，若 A 和 B 都为正且 F 为负，则溢出。所以溢出标志 $\rm OF = (\overline{A_{15}}\land\overline{B_{15}}\land F_{15})\lor (A_{15}\land B_{15}\land\overline{F_{15}})$ ，或记作 $\rm OF = \overline{A_{15}}\cdot\overline{B_{15}}\cdot F_{15}+A_{15}\cdot B_{15}\cdot\overline{F_{15}}$ 。A 减 B 时，A-B→F。若 A 为负、B 为正且 F 为正，则溢出，或者，若 A 为正、B 为负且 F 为负，则溢出。所以溢出标志 $\rm OF = (\overline{A_{15}}\land B_{15}\land F_{15})\lor (A_{15}\land \overline{B_{15}}\land\overline{F_{15}})$ ，或记作 $\rm OF = \overline{A_{15}}\cdot B_{15}\cdot F_{15}+A_{15}\cdot \overline{B_{15}}\cdot\overline{F_{15}}$ 。
> 
> (2) 因为在单总线结构中，每个时刻总线上只有一个数据有效，而 ALU 有两个输入端和一个输出端。因此，当 ALU 运算时，首先需要用暂存器 Y 缓存其中一个输入端的数据，在通过总线传送另一个输入端的数据。当 ALU 的输出端产生运算结果，但由于该节拍总线被占用，因此需要暂存器 Z，用来缓存 ALU 的输出端数据。
> 
> (3) 第一问。由图可知，通用寄存器 rs 和 rd 都是 4bit，因此通用寄存器组 GPRs 在最多有 $2^4=16$ 个通用寄存器。
> 
> 第二问。参考 2021 年题 43，rs 和 rd 都是寄存器编号，对应寄存器用于存储指令中的操作数，指令寄存器 IR 中存储指令，所以 rs 和 rd 来自指令寄存器 IR。
> 
> 第三问。rd 是寄存器编号，应该连接地址译码器，地址译码器可以根据指令中的目标寄存器编号选择要写入的寄存器。
> 
> 地址译码器：用于将地址信号转换为特定设备或存储单元的选择信号。在计算机系统中，地址译码器通常被用来选择内存中的特定单元或者外设的特定寄存器。它接收来自 CPU 或外设的地址信息，并根据这些地址信息选中需要操作的特定设备或存储单元。地址译码器通常被用于内存芯片、I/O 接口芯片等场合，以实现对特定存储单元或寄存器的访问。
> 
> 多路选择器：用于从多个输入信号中选择一个输出。它的输出信号取决于控制信号。多路选择器通常由 $2^n$ 个输入端、 $n$ 个控制端和一个输出端组成。在计算机系统中，多路选择器常常被用于选择要写入的寄存器或执行特定操作的数据通路。通过控制信号，它能够将某个特定的输入信号输出到目标位置，从而实现对不同信号的选择和路由。
> 
> (4) 第一问。取指周期（不考虑 PC 增量操作）的过程如下
> 
> $$\begin{array}{|c|c|c|}\hline \text{节拍}&\text{指令功能}&\text{信号}\\\hline \rm T0&\text{(PC)→MAR,1→R}&\text{PCout=1, MARin=1, Read=1}\\\hline \rm T1&\text{M(MAR)→MDR}&\\\hline \rm T2&\text{(MDR)→IR}&\text{MDRout=1, IRin=1}\\\hline \end{array}$$
> 
> (PC)→MAR 和 1→R 不存在冲突，可以并行执行。
> 
> 所以信号序列为①PCout = 1, MARin = 1, Read = 1 ②MDRout = 1, IRin = 1。其中值为 0 的寄存器输入 / 输出控制信号以及值为任意的其他控制信号均省略。
> 
> 参考一：2015 年题 44
> 
> 本题可参考 **2015 年题 44** 图 a 中取指周期的控制信号序列：
> 
> ![](https://pic2.zhimg.com/v2-7f1a04899cd4844536b067c65a1967f3_r.jpg)
> 
> - T0: PCout = 1, MARin = 1, Tin = 1, MEMop = read
> - T1: MUXop = 0, ALUop = add, SRop = mov
> - T2: SRout = 1, PCin = 1
> - T3: MDRout = 1, IRin = 1
> 
> 该指令 T1 和 T2 执行的是 (PC)+1→PC 操作，去除 T1 和 T2 即可得本题的信号序列。
> 
> 参考二：《计算机组成原理》唐朔飞版 10.1.2 微操作的节拍安排
> 
> 安排微操作节拍时应注意以下 3 点。
> 
> ①有些操作的次序是不容改变的，故安排微操作节拍时必须注意微操作的先后顺序。
> 
> ②凡是被控制对象不同的微操作，若能在一个节拍内执行，应尽可能安排在同一个节拍内，以节省时间。
> 
> ③如果有些微操作所占的时间不长，应该将它们安排在一个节拍内完成，并允许这些微操作有先后次序。
> 
> 按上述 3 条原则，以 9.1 节所分析的 10 条指令为例，其微操作的节拍安排如下：
> 
> 取值周期微操作的节拍安排
> 
> 根据原则②，T0 节拍可以安排两个微操作：(PC)→MAR,1→R。
> 
> 根据原则②，T1 节拍可安排 M(MAR)→MDR 和 (PC)+1→PC 两个微操作。
> 
> T2 节拍可安排 (MDR)→IR，考虑到指令译码时间较短，根据原则③，可将指令译码 OP(IR)→ID 也安排在 T2 节拍内。
> 
> 实际上 (PC)+1→PC 操作也可以安排在 T2 节拍内，因一旦 (PC)→MAR 后，PC 的内容就可以修改。
> 
> 注：王道给出的参考答案是①PCout, MARin ②Read ③MDRout, IRin。将 PCout=1 简写为 PCout 是可以的。将 1→R 放到 T1 执行是可行的。至于为什么这么改，应该是受后面一句话（若从发出主存读命令到主存读出数据并传送到 MDR 共需 5 个时钟周期）的影响。这句话中把 1→R 和 M(MAR)→MDR 视为一个整体，而 (PC)→MAR 和 1→R, M(MAR)→MDR 存在同步关系，所以修改取指周期（不考虑 PC 增量操作）的过程如下
> 
> $$\begin{array}{|c|c|c|}\hline \text{节拍}&\text{指令功能}&\text{信号}\\\hline \rm T0&\text{(PC)→MAR}&\text{PCout=1, MARin=1}\\\hline \rm T1&\text{1→R, M(MAR)→MDR}&\text{Read=1}\\\hline \rm T2&\text{(MDR)→IR}&\text{MDRout=1, IRin=1}\\\hline \end{array}$$
> 
> 所以信号序列为①PCout = 1, MARin = 1 ②Read = 1 ③MDRout = 1, IRin = 1。其中值为 0 的寄存器输入 / 输出控制信号以及值为任意的其他控制信号均省略。
> 
> 第二问。T0 至少需要 1 个时钟周期，从发出主存读命令到主存读出数据并传送到 MDR 共需 5 个时钟周期，即 T1 需要 5 个时钟周期，T2 至少需要 1 个时钟周期，因此取指阶段至少需要 1+5+1=7 个时钟周期。
> 
> (5) 第一问。图中控制信号由控制单元 CU 产生。
> 
> 第二问。指令寄存器 IR 和标志寄存器 FR 的输出信号会连接到控制部件的输入端。