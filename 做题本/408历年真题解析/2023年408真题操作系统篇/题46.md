---
publish: true
tags: 
aliases: 
finished: true
title: 题46
created: "2024-11-21 07:29"
updated: "2024-11-21 07:40"
---
## 题46
### 题目
> [!question]+
> （8 分）
> 
> 进程 P 通过执行系统调用从键盘接收一个字符的输入，已知此过程中与进程 P 相关的操作包括：①将进程 P 插入就绪队列；②将进程 P 插入阻塞队列；③将字符从键盘控制器读入系统缓冲区；④启动键盘中断处理程序；⑤进程 P 从系统调用返回；⑥用户在键盘上输入字符。以上编号①~⑥仅用于标记操作，与操作的先后顺序无关。请回答下列问题。
> 
> (1) 按照正确的操作顺序，操作①的前一个和后一个操作分别是上述操作中的哪一个？操作⑥的后一个操作上述操作中的哪一个？
> 
> (2) 在上述哪个操作之后 CPU 一定从进程 P 切换到其他进程？在上述哪个操作之后 CPU 调度程序才能选择进程 P 执行？
> 
> (3) 完成上述哪个操作的代码属于键盘驱动程序？
> 
> (4) 键盘中断处理程序执行时，进程 P 处于什么状态？CPU 处于内核态还是用户态？
### 解
> [!done]+
> (1) 正确的操作顺序如下：
> 
> ②将进程 P 插入阻塞队列：由于进程 P 执行了从键盘接收输入的系统调用（例如执行 C 语言的 scanf() 函数），需要等待用户输入完成才能继续执行。因此，进程 P 会被插入阻塞队列，等待键盘[[中断处理程序]]的处理。
> 
> ⑥用户在键盘上输入字符：用户在键盘上输入字符，键盘[[控制器]]会将字符传递给[[操作系统]]进行处理。
> 
> ④启动键盘[[中断处理程序]]：当键盘控制器有新的输入字符时，会发出[[中断]][[信号]]通知操作系统，启动相应的键盘[[中断处理程序]]。
> 
> ③将字符从键盘控制器读入系统缓冲区：键盘控制器会将用户在键盘上输入的字符读入系统缓冲区，准备供后续处理。
> 
> ①将进程 P 插入就绪队列：当键盘[[中断处理程序]]完成了对输入字符的处理，并且准备唤醒等待输入的进程时，会将进程 P 从阻塞队列移动到就绪队列，准备继续执行。
> 
> ⑤进程 P 从[[系统调用]]返回：当进程 P 从阻塞队列移到就绪队列后，它会被调度执行。在该过程中，进程 P 会在系统调用结束后从系统调用返回，继续执行后续的指令。
> 
> 综上，正确的操作顺序是②、⑥、④、③、①、⑤。
> 
> 第一问。操作①的前一个操作是③，后一个操作是⑤。
> 
> 第二问。操作⑥的后一个操作是④。
> 
> (2) 第一问。在上述操作中，CPU 一定会从进程 P 切换到其他进程的操作是②将进程 P 插入阻塞队列。当进程 P 被插入阻塞队列后，它无法继续执行，因此 CPU 会在此时切换到其他可执行的进程。
> 
> 第二问。在上述操作中，CPU 调度程序才能选择进程 P 执行的操作是①将进程 P 插入就绪队列。当进程 P 被插入就绪队列后，CPU 调度程序可以从就绪队列中选择它来执行。在此之前，进程 P 处于阻塞状态，不可被调度执行。只有当进程 P 被插入就绪队列后，CPU 调度程序才有机会选择它作为下一个要执行的进程。
> 
> (3) 键盘驱动程序负责与硬件键盘进行交互，并将键盘输入的字符传递给操作系统进行处理。在完成键盘输入的过程中，键盘驱动程序会读取键盘控制器的输入，将字符存储到系统缓冲区中，以便其他进程或系统调用可以访问该字符。因此完成上述操作的代码属于键盘驱动程序的操作是③将字符从键盘控制器读入系统缓冲区。
> 
> (4) 第一问。当键盘[[中断处理程序]]执行时，进程 P 处于阻塞状态。因为当键盘[[中断处理程序]]被触发时，进程 P 已经执行了系统调用并被插入阻塞队列。该进程暂停执行，等待键盘输入的中断处理程序完成并将其从阻塞队列移动到就绪队列中。只有在进程 P 从阻塞队列移到就绪队列后，才有机会被 CPU 调度执行。因此，在键盘中断处理程序执行时，进程 P 处于阻塞状态或等待状态。
> 
> 第二问。当键盘中断处理程序被触发时，CPU 处于[[内核]]态。键盘中断处理程序通常在内核态下执行，因为它需要对硬件进行直接的访问和操作，例如读取键盘控制器、处理键盘输入等。在内核态下执行可以获得更高的权限和对系统资源的直接访问能力，从而快速响应中断并处理相应的操作。