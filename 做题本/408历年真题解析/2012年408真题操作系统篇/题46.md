---
publish: true
tags: 
aliases: 
finished: true
title: 题46
created: "2024-11-21 06:41"
updated: "2024-11-21 07:40"
---
## 题46
### 题目
> [!question]+
> （8 分）
> 
> 某文件系统空间的最大容量为 4TB（1TB= $2^{40}$ B），以磁盘块为基本分配单位。磁盘块大小为 1KB。文件控制块 (FCB) 包含一个 512B 的索引表区。请回答下列问题。
> 
> (1) 假设索引表区仅采用直接索引结构，索引表区存放文件占用的磁盘块号，索引表项中块号最少占多少字节？可支持的单个文件最大长度是多少字节？
> 
> (2) 假设索引表区采用如下结构：第 0～7 字节采用 <起始块号，块数> 格式表示文件创建时预分配的连续存储空间，其中起始块号占 6B，块数占 2B；剩余 504 字节采用直接索引结构，一个索引项占 6B，那么可支持的单个文件最大长度是多少字节？为了使单个文件的长度达到最大，请指出起始块号和块数分别所占字节数的合理值并说明理由。
### 解
> [!done]+
> (1) 第一问。因为该文件系统空间的最大容量为 4TB，磁盘块大小为 1KB，所以该文件系统中所能容纳的磁盘块总数为 4TB/1KB= $2^{32}$ 。要完全表示所有磁盘块，索引项中的块号最少要占 32bit=4B。
> 
> 第二问。因为文件控制块 (FCB) 包含一个 512B 的索引表区，根据第一问结果，索引表项中块号最少占 4 字节，索引表区仅采用直接索引结构，所以索引表区最多能容纳 512B/4B=128 个索引项。又因为每个索引项对应一个磁盘块，磁盘块大小为 1KB，所以该系统可支持的单个文件最大长度是 128×1KB=128KB。
> 
> (2) 第一问。因为块数占 2B=16bit，共可以表示 $2^{16}$ 个磁盘块，磁盘块大小为 1KB，所以预分配的连续存储空间大小为 $2^{16}$ ×1KB= $2^{16}$ KB。又因为块号占 6B，剩余 504 字节采用直接索引结构，直接索引区共 504B/6B=84 个索引项，磁盘块大小为 1KB，所以直接索引区存储空间大小为 84×1KB=84KB。综上，该系统可支持的单个文件最大长度 = 预分配的连续存储空间大小 + 直接索引区存储空间大小 = $2^{16}$ KB+84KB=65620KB。
> 
> 第二问。根据 (1) 中第一问的结果，块数最少要占 4B，才可表示 4TB 大小的文件长度，此时达到文件系统的空间上限，第 0～7 字节采用 <起始块号，块数> 格式表示文件创建时预分配的连续存储空间，总共 8B，所以合理的起始块号和块数所占字节数分别为 4、4，或 3、5，或 2、6，或 1、7。