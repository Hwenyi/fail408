---
publish: true
tags: []
aliases: 
finished: true
title: 题18
created: "2024-11-17 18:18"
updated: "2024-12-18 14:11"
---
## 题18
### 题目
【2020 统考真题】某校园网有两个局域网，通过路由器 R1、R2 和 R3 互联后接入 Internet，S1 和 S2 为以太网交换机。局域网采用静态 IP 地址配置，路由器部分接口以及各主机的 IP 地址如下图所示。

![](https://img.hwenyi.live/202411222235693.webp)

假设 NAT 转换表结构为：

![](https://img.hwenyi.live/202411222235694.webp)

请回答下列问题：

(1) 为使 H2 和 H3 能够访问 Web 服务器（使用默认端口号），需要进行什么配置？

(2) 若 H2 主动访问 Web 服务器时，将 HTTP 请求报文封装到 IP 数据报 P 中发送，则 H2 发送 P 的源 IP 地址和目的 IP 地址分别是什么？经过 R3 转发后，P 的源 IP 地址和目的 IP 地址分别是什么？经过 R2 转发后，P 的源 IP 地址和目的 IP 地址分别是什么？
### 分析
现在第二次做，记住，[[NAT网络地址转换|NAT]]出去修改的[[源IP地址-ipv4]]是公网那个，不是192的内网的自己的，这个题目不是要自己分配路由网络的那种：[[刷题/计网每日一题/第九周/题1]]，我现在第二次做以为是，另外还是这个问题，经过[[NAT网络地址转换|NAT]]，直到最后离公网最近那个[[路由器的基本工作原理|路由器]]才会把目的改掉，其他的内网路由器都是指向这个离公网最近的
![](https://img.hwenyi.live/202412182210535.webp)
[[刷题/408真题分类/计网真题/第 4 章网络层/4.2 IPv4/题22]]
![](https://img.hwenyi.live/202412182210545.webp)
### 解
[[刷题/408历年真题解析/2020年408真题计算机网络篇/题47]]
1) $H2$ 和 $H3$ 与 Web 服务器处于不同的局域网,路由器 R2、R3 具有 NAT 功能。当 R2 从 WAN 口收到来自 H2 或 H3 发来的 HTTP 请求时, 根据 NAT 表发送给 Web 服务器的对应端口。为使外部主机能正常访问 Web 服务器, 应在 R2 的 NAT 表中增加一项, 外网的 IP 地址配置为路由器的外端 IP 地址, 内网的 IP 地址配置为 Web 服务器的 IP 地址, HTTP 的服务器端的默认端口号为 80 , 因此外网和内网的端口号都需配置为 80 。只需在 R2 中配置 Web 服务器的 NAT 表项, 而不用在 R3 中配置 H2 和 H3 的 NAT 表项, 原因在于我们只知道 Web 服务器的端口号 80, 而客户端的端口号是随机分配的, 无法做静态配置, 只能通过自动动态配置实现。R2 的 NAT 表配置如下:

| 外网     |       | 内       |       |
| -------- | ----- | -------- | ----- |
| IP 地址  | 端口号 | IP 地址  | 端口号 |
| 203.10.2.2 | 80    | 192.168.1.2 | 80    |

2) 因为启用了 NAT 服务, H2 发送的 P 的源 IP 地址应该是 H2 的内网地址, 目的地址应该该是 $R2$ 的外网 IP 地址,源 IP 地址是 192.168.1.2,目的 IP 地址是 203.10.2.2。R3 转发后, 将 $P$ 的源 $\mathrm {{IP}}$ 地址改为 $R3$ 的外网 $\mathrm {{IP}}$ 地址,目的 $\mathrm {{IP}}$ 地址仍然不变,源 $\mathrm {{IP}}$ 地址是 203.10.2.6. 目的 IP 地址是 203.10.2.2。R2 转发后,将 $P$ 的目的 IP 地址改为 Web 服务器的内网地址. 源地址仍然不变, 源 IP 地址是 203.10.2.6, 目的 IP 地址是 192.168.1.2。
