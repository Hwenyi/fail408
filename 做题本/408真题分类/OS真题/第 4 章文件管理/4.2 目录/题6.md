## 题6
### 题目
> [!question]+
> 【2022 统考真题】某文件系统的磁盘块大小为 4KB，目录项由文件名和索引节点号构成，每个索引节点占 256 字节，其中包含直接地址项 10 个，一级、二级和三级间接地址项各 1 个，每个地址项占 4 字节。该文件系统中子目录 stu 的结构如题 45(a) 图所示，stu 包含子目录 course 和文件 doc，course 子目录包含文件 course1 和 course2。各文件的文件名、索引节点号、占用磁盘块的块号如题 45(b) 图所示。
> 
> ![](https://img.hwenyi.live/202412161948970.webp)
> 
> 文件名索引节点号磁盘块号
> 
> $$\begin{array}{|c|}\hline \text{文件名}&\text{索引节点号}&\text{磁盘块号}\\\hline \text{stu}&1&10\\ \text{course}&2&20\\ \text{course1}&10&30\\ \text{course2}&100&40\\ \text{doc}&10&x\\\hline \end{array}$$
> 
> 题 45(b) 图
> 
> 请回答下列问题。
> 
> (1) 目录文件 stu 中每个目录项的内容是什么？
> 
> (2) 文件 doc 占用的磁盘块的块号 $x$ 的值是多少？
> 
> (3) 若目录文件 course 的内容已在内存，则打开文件 course1 并将其读入内存，需要读几个磁盘块？说明理由。
> 
> (4) 若文件 course2 的大小增长到 6MB，为了存取 course2 需要使用该文件索引节点的哪几级间接地址项？说明理由。
### 分析
> [!NOTE]+
> 我们看这个题目:[[刷题/408真题分类/OS真题/第 4 章文件管理/4.1 文件/题3]]，这个题目基本上是小题改大题，我忘记了[[索引节点]]是文件的唯一表示，[[目录项]]就是[[文件控制块|FCB]]，[[目录]]是FCB的集合
> [[目录]]里面的[[目录项]]是不递归的，子目录里面的东西不写
> 文件在物理块的存储，通过[[索引节点]]组织起来
> ![|500](https://img.hwenyi.live/202412162003483.webp)
> ![|325](https://img.hwenyi.live/202412162033782.webp)
> [[刷题/25OS-王道/第 4 章 文件管理/综合题/题11]]
### 解
> [!done]+
> 1. 题目告诉我们目录项由文件名和索引结点号构成，stu包含子目录course和文件doc，因此stu的目录项内容如下表所示：
>  ![](https://img.hwenyi.live/202411091346445.webp)
> 2. 由于doc和course的索引结点号相同，均为10，因此两者共用一个索引结点，对应同一个文件。由题目知course的磁盘块号是30，因此doc的磁盘块号也是30，即x的值为30。
> 3. 读2个磁盘块。当目录文件course的内容已在内存，打开文件course并将其读入内存需要经历以下步骤：找到并读取course的索引结点，根据course的索引结点找到对应的磁盘块号并读取磁盘里的文件course。上述过程中，由于索引结点也是存储在磁盘里的，因此需要读取1次索引结点所在的磁盘块；然后根据索引结点再读取文件course所在的磁盘块，所以一共要读取两个磁盘块。
> 4. 10个直接地址项记录的盘块总共占用4KB×10=40KB：一级间接地址记录的盘块总共占用4KB÷4B×4KB=210×4KB=4MB，二级间接地址项记录的盘块总共占用4KB÷4B×4MB=210×4MB=4GB。40KB+4MB<6MB<40KB+4MB+4GB，故需要用到一级间接地址项和二级间接地址项。