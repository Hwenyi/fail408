---
TARGET DECK: 刷题::25计组-王道::第 5 章 中央处理器::5.6 指令流水线::题31
---
## 题31
### 题目
Q:【2023统考真题】在采用“取指、译码/取数、执行、访存、写回”5段流水线的RISC处理器中，执行如下指令序列（第一列为指令序号），其中s0、S1、s2、s3和t2表示寄存器编号。
```assembly
I1  add  s2,s1,s0  // R[s2]←-R[sI]+R[sO]
I2  load s3,0(s2)  // R[s3]←-M[R[s2]+O]
I3  beq  t2,s3,LI  // if R[t2]=R[s3] jump to L1
I4  addi t2,t2,20  // R[t2]←-R[t2]+20
I5  L1:
```
若采用转发（旁路）技术处理数据冒险，采用硬件阻塞方式处理控制冒险，则在指令I1~I4的执行过程中，发生流水线阻塞的指令有（）。
A. 仅 I3 
B. 仅 I2、I4 
C. 仅 I3、I4 
D. 仅 I2、I3、I4
### 分析
A: [[控制冒险]]就是等分支跳转指令的造成的，这里的[[数据冒险]]因为题目说的插入了旁路来解决，所以不会让[[流水线]]阻塞，只有I3到I4之间因为要等待beq的结果，所以会阻塞
![](https://img.hwenyi.tech/202412160238437.webp)

### 解
C
- I2 和 I1 之间存在数据冒险
    - I1 在 WB 段才将新值写回寄存器 R[s2]
    - I2 的 Ex 段就要读 $R\lbrack  {s2}\rbrack$ 以计算访存的有效地址
    - II 在 EX 段结束时就已生成 $R\lbrack  {s2}\rbrack$ 的新值
    - 被存放在 Ex/Mem 流水段寄存器中
    - 采用转发技术后, 可直接从该寄存器中取出数据送到 ALU 的输入端
    - 这样 I2 执行时 ALU 用的是 R[s2]的新值
    - 解决了 I2 和 I1 之间的数据冒险
- I3 和 I2 之间存在数据冒险
    - 属于 load-use 数据冒险
    - 用转发电路无法解决 I3 和 I2 的数据相关问题
    - 原因在于 I2 的功能是从内存中取数
    - 只有在 Mem 段结束时才能从主存中得到 $R\lbrack  {s3}\rbrack$ 的新值
    - 但 I3 的 EX 段就要用到 $R\lbrack  {s3}\rbrack$ 
    - 因此无法用转发技术解决
    - 13 仍需阻塞一个时钟周期
    - 等到 I2 的 Mem 段结束后
    - 从 12 的 Mem/Wb 流水段寄存器中取到 R[s3]的新值
- I4 和 I3 之间存在控制冒险
    - beq 指令在 Ex 段设置条件码
    - 在 Mem 段控制是否将转移地址送到 PC
    - 这之后才能开始根据 PC 内容取指令
    - 因此 I4 需要进行硬件阻塞
- 综上所述, I3 和 I4 的执行需要被阻塞
    - 指令的执行过程如下表所示

| I1   | IF   | ID   | EX   | Mem  | WB   |      |      |      |      |      |      |      |
|------|------|------|------|------|------|------|------|------|------|------|------|------|
| I2   |      | IF   | ID   | EX   | Mem  | WB   |      |      |      |      |      |      |
| I3   |      |      | IF   | ID   | 阻塞 | EX   | Mem  | WB   |      |      |      |      |
| I4/I5|      |      |      | 阻塞 | 阻塞 | 阻塞 | 阻塞 | IF   | ID   | EX   | Mem  | WB   |
