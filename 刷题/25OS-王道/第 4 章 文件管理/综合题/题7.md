---
publish: true
tags: 
aliases: 
finished: true
title: 题7
created: 2024-11-06 07:05
updated: 2024-11-09 05:31
---
## 题7
### 题目
【2012 统考真题】某文件系统空间的最大容量为 $4{TB}$ ( $1{TB} = {2}^{40}\;B$ ),以磁盘块为基本分配单位。磁盘块大小为 $1{KB}$ 。文件控制块（FCB）包含一个 ${512}\;B$ 的索引表区。请回答下列问题:
1. 假设索引表区仅采用直接索引结构，索引表区存放文件占用的磁盘块号，索引表项中块号最少占多少字节? 可支持的单个文件的最大长度是多少字节?
2. 假设索引表区采用如下结构：第 0 ~ 7 字节采用<起始块号, 块数>格式表示文件创建时预分配的连续存储空间。其中起始块号占 $6\;B$ ,块数占 $2\;B$ ,剩余 504B 采用直接索引结构, 一个索引项占 6B, 则可支持的单个文件的最大长度是多少字节? 为使单个文件的长度达到最大, 请指出起始块号和块数分别所占字节数的合理值并说明理由。
### 分析
[[刷题/408真题分类/OS真题/第 4 章文件管理/4.1 文件/题17]]
### 解
1. 文件系统中所能容纳的磁盘块总数为 $4{TB}/1{KB} = {2}^{32}$ 。要完全表示所有磁盘块,索引项中的块号最少要占 ${32}/8 = 4\;B$ 。而索引表区仅采用直接索引结构,因此 ${512}\;B$ 的索引表区能容纳 ${512}\;B/4\;B = {128}$ 个索引项。每个索引项对应一个磁盘块,所以该系统可支持的单个文件最大长度是 ${128} \times 1{KB} = {128}{KB}$ 。
2. 这里考查的分配方式不同于我们熟悉的三种经典分配方式, 但题目中给出了详细的解释。 所求的单个文件最大长度一共包含两部分: 预分配的连续空间和直接索引区。

连续区块数占 $2\;B$ ,共可表示 ${2}^{16}$ 个磁盘块,即 ${2}^{26}\;B$ 。直接索引区共 ${504}\;B/6\;B = {84}$ 个索引项。所以该系统可支持的单个文件最大长度是 ${2}^{26}\;B + {84}{KB}$ 。

为了使单个文件的长度达到最大, 应使连续区的块数字段表示的空间大小尽可能接近系统最大容量 $4{TB}$ 。分别设起始块号和块数占 $4\;B$ ,这样起始块号可以寻址的范围是 ${2}^{32}$ 个磁盘块,共 4TB,即整个系统空间。同样,块数字段可以表示最多 ${2}^{32}$ 个磁盘块,共 4TB。