---
publish: true
tags: 
aliases: 
finished: true
title: 题47
created: "2024-11-21 07:32"
updated: "2024-11-21 07:40"
---
## 题47
### 题目
> [!question]+
> （本题 9 分）
> 
> 网络空间是继陆海空天之后的 “第五疆域”，网络技术是网络疆域建设与治理的基础。路由算法与协议是网络核心技术之一，对其准确认知，合理选择与应用，对于网络建设十分重要。假设现有互联网中的 4 个自治系统互连拓扑示意图如题 47 图所示。其中，AS1 运行内部网关协议 RIP；AS3 规模较小，自治系统内任意两个主机间通信，经过路由器数量不超过 15 个；AS4 规模较大，自治系统内任意两个主机间通信，经过路由器数量可能超过 20 个。
> 
> ![](https://img.hwenyi.tech/202412141522755.webp)
> 
> 请回答下列问题：
> 
> (1) 若仅有 RIP 和 OSPF 内部网关协议供选择，则 AS4 应选择哪个协议?（1 分）
> 
> (2) 若 AS3 中的某主机向本自治系统内另一主机发送 1 个 IP 分组，为确保该 IP 分组能够被正常接收，则该 IP 分组的初始 TTL 值应该至少设置为多少？（1 分）
> 
> (3) 假设 AS1 中的路由器同一时刻启动，启动后立即构建并交换初始距离向量，之后每隔 30 s 交换一次最新的距离向量，则从交换初始距离向量时刻算起，R11~R16 路由器均获得到达网络 210.2.3.0/24 的正确路由，至少需要多长时间？均获得到达网络 210.2.4.0/24 的正确路由，至少需要多长时间？（2 分）
> 
> (4) R44 向 R13 通告到达网络 136.5.16.0/20 路由时，由 BGP 协议哪类会话完成？通过哪个 BGP 报文通告？R13 通过 BGP 协议的哪类会话将该网络可达性信息通告给 R14 和 R15。（3 分）
> 
> (5) 若 R14 和 R15 均收到分别由 R11、R12、R13 通告的到达网络 136.5.16.0/20 的可达性信息如下。
> 
> 目的网络：136.5.16.0/20，AS 路径：AS2 AS8 AS19，下一跳：R11
> 
> 目的网络：136.5.16.0/20，AS 路径：AS3 AS7 AS11 AS19，下一跳：R12
> 
> 目的网络：136.5.16.0/20，AS 路径：AS4 AS10 AS19，下一跳：R13
> 
> 则在无策略约束情况下，R14 和 R15 更新路由表后，各自路由表中到达网络 136.5.16.0/20 路由的下一跳分别是什么（用路由器名称表示）？（2 分）
### 解
> [!done]+
> (1) AS4 应选择 OSPF 协议。
> 
> RIP 是基于距离矢量算法的路由协议，利用跳数来作为计量标准。在带宽、配置和管理方面要求较低，主要适合于规模较小的网络中。
> 
> OSPF 是广泛使用的一种动态路由协议，它属于链路状态路由协议，具有路由变化收敛速度快、无路由环路、支持变长子网掩码（VLSM）和汇总、层次区域划分等优点。适用于大型网络。
> 
> 根据题目条件，AS4 的规模较大，自治系统内任意两个主机间通信，经过路由器数量可能超过 20 个。RIP 协议限制跳数最为为 15 跳，跳数为 16 表示目的网络不可达，所以当自治系统内路由器个数大于 20 时，只能选择 OSPF 协议。且 OSPF 提供了灵活性和可扩展性，能够更好地满足大型网络的需求。
> 
> (2) 初始 TTL 值应该至少设置为 16。
> 
> 根据题目条件，AS3 规模较小，自治系统内任意两个主机间通信，经过路由器数量不超过 15 个，每经过一个路由器，TTL 值就会减 1，当 TTL 值为 0 时，IP 分组将被丢弃。为了确保该 IP 分组能正常接收，TTL 应至少设置为 15 + 1 = 16。
> 
> (3) R11~R16 路由器均获得到达网络 210.2.3.0/24 的正确路由，至少需要 30s；均获得到达网络 210.2.4.0/24 的正确路由，至少需要 60s。
> 
> RIP 仅和相邻的路由器交换信息。路由器到其直连网络的距离为 1。
> 
> 注意，该问题假设 AS1 中的路由器同一时刻启动，启动后立即构建并交换初始距离向量，并不是 30 s 后才第一次交换距离向量。
> 
> **方法一：模拟**
> 
> 初始距离向量构建完成后，每次每个路由器和相邻的路由器交换信息，选择距离目的网络跳数更少的路由进行更新。
> 
> ![](https://img.hwenyi.tech/202412141522756.webp)
> 
> 模拟后发现，30 s 后，R11~R16 路由器到达网络 210.2.3.0/24 的路由不再改变；60 s 后，R11~R16 路由器到达网络 210.2.4.0/24 的路由不再改变。因此，R11~R16 路由器均获得到达网络 210.2.3.0/24 的正确路由，至少需要 30 s；均获得到达网络 210.2.4.0/24 的正确路由，至少需要 60 s。
> 
> **方法二：最短路径算法**
> 
> 使用最短路径算法进行模拟，由于相邻路由器之间的距离为单位长度，用于计算距离向量的算法可以简化为广度优先搜索，每隔 30 秒，从源点向外扩散一层。
> 
> 对于网络 210.2.3.0/24，模拟过程如下。
> 
> ![](https://img.hwenyi.tech/202412141522757.webp)
> 
> 经过两次交换，R11~R16 路由器到网络 210.2.3.0/24 均可达。初始时交换一次，之后每次交换间隔 30 s，因此 R11~R16 路由器均获得到达网络 210.2.3.0/24 的正确路由，至少需要 30 s × (2 - 1) = 30 s。
> 
> 对于网络 210.2.4.0/24，模拟过程如下。
> 
> ![](https://img.hwenyi.tech/202412141522758.webp)
> 
> 经过三次交换，R11~R16 路由器到网络 210.2.4.0/24 均可达。初始时交换一次，之后每次交换间隔 30 s，因此 R11~R16 路由器均获得到达网络 210.2.4.0/24 的正确路由，至少需要 30 s × (3 - 1) = 60 s。
> 
> (4) R44 向 R13 通告到达网络 136.5.16.0/20 路由时，由 BGP 协议外部会话 (eBGP) 完成；通过 UPDATE 报文通告；R13 通过 BGP 协议内部会话 (iBGP) 将该网络可达性信息通告给 R14 和 R15。
> 
> 两个边界路由器进行通话时，需要建立 eBGP 连接，e 表示外部 external。R44 和 R13 分别是 AS4 和 AS1 的边界路由，两者通信由 BGP 协议外部会话 (eBGP) 完成。
> 
> BGP 协议默认使用 BGP-4，在 RFC 4271 中规定了 BGP-4 的四种报文。
> 
> - ① OPEN（打开）报文，用来与 BGP 连接对等端建立关系。
> - ② UPDATE（更新）报文，用来通告某一路由的信息，以及列出要撤消的路由。
> - ③ KEEPALIVE（保活）报文，用来周期性地证实与对等端的连通性。
> - ④ NOTIFICATION（通知）报文，用来发送检测到的差错。
> 
> 其中，UPDATE 报文是 BGP 协议的核心，用来撤销它曾经通知过的路由，或者宣布增加新的路由。撤消路由可以一次撤消许多条，但增加新路由时，每个更新报文只能增加一条。
> 
> 即 UPDATE 报文用于在对等端之间传递路由信息，所以 R44 向 R13 通告到达网络 136.5.16.0/20 路由需要通过 UPDATE 报文通告。
> 
> 在自治系统内部，两个路由器之间需要建立 iBGP 连接，i 表示内部 internal。因为 R13、R14 和 R15 同属于自治系统 AS1，所以 R13 通过 BGP 协议内部会话 (iBGP) 将该网络可达性信息通告给 R14 和 R15。
> 
> (5) R14 路由表中到达网络 136.5.16.0/20 路由的下一跳是 R11。R15 路由表中到达网络 136.5.16.0/20 路由的下一跳是 R13。
> 
> 本问考察 BGP 的路由选择策略。无策略约束情况下，若有多条 BGP 路由可供选择，则按照以下原则，按照这里给出的先后顺序，选择一条较好的 BGP 路由。
> 
> - 策略 1：选择本地偏好 (Local Preference, LOCAL-PREF) 值最高的路由。
> - 策略 2：选择具有 AS 跳数最少的路由。
> - 策略 3：使用热土豆路由算法 (Hot Potato Routing Algorithm)。选择本 AS 内跳数最少的路由进行转发，使得分组尽快离开本 AS。
> - 策略 4：选择 BGP 标识符数值最小的路由。
> 
> 观察题 47 图，AS1 要到达网络 136.5.16.0/20，必须经过 AS2、AS3 或 AS4，AS1 中连接 AS2 的边界路由器是 R11，AS1 中连接 AS3 的边界路由器是 R12，AS1 中连接 AS4 的边界路由器是 R13。也就是 AS1 中路由器要到达网络 136.5.16.0/20，必须经过 R11、R12 或 R13。
> 
> 或者根据本问条件，由 R11、R12、R13 通告的到达网络 136.5.16.0/20 的可达性信息，R14 和 R15 要到达网络 136.5.16.0/20，有三条路由可以选择。同样可以分析出 AS1 中路由器要到达网络 136.5.16.0/20，必须经过 R11、R12 或 R13。
> 
> 本题中，没有给出 LOCAL-PREF，排除策略 1；
> 
> 根据题目条件，三条路由如下：
> 
> 1. 目的网络：136.5.16.0/20，AS 路径：AS2 AS8 AS19，下一跳：R11
> 2. 目的网络：136.5.16.0/20，AS 路径：AS3 AS7 AS11 AS19，下一跳：R12
> 3. 目的网络：136.5.16.0/20，AS 路径：AS4 AS10 AS19，下一跳：R13
> 
> 根据策略 2，选择具有 AS 跳数最少的路由。第 1 条路由有 3 跳，第 2 条路由有 4 跳，第 3 条路由有 3 跳，保留第 1 条和第 3 条路由为备选路由。
> 
> 1. 目的网络：136.5.16.0/20，AS 路径：AS2 AS8 AS19，下一跳：R11
> 2. 目的网络：136.5.16.0/20，AS 路径：AS4 AS10 AS19，下一跳：R13
> 
> 接下来使用策略 3，AS1 使用 RIP 协议，路由器选择距离自己跳数最少的路由进行转发。
> 
> R14 要到达网络 136.5.16.0/20，选择 R11、R12 或 R13 中距离自己跳数最少的边界路由器进行转发，显然选择 R14→R11 这条路径，下一跳为 R11。
> 
> R15 要到达网络 136.5.16.0/20，选择 R11、R12 或 R13 中距离自己跳数最少的边界路由器进行转发，显然选择 R15→R13 这条路径，下一跳为 R13。