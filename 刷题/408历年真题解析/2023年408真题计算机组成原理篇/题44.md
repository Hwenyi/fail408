---
publish: true
tags: 
aliases: 
finished: true
title: 题44
created: "2024-11-21 07:30"
updated: "2024-11-21 07:40"
---
## 题44
### 题目
> [!question]+
> （9 分）
> 
> 题 43 中 C 程序段在计算机 M 上的部分机器级代码如下，每个机器级代码行中依次包含指令序号、虚拟地址、机器指令和汇编指令。
> 
> ```cpp
> for(i=0; i<24; i++)
> 1   00401072  C7 45 F8 00 00 00 00              mov[ebp-8], 0
> 2   00401079  EB 09                             jmp 00401084h
> 3   0040107B  8B 55 F8                          mov eax, [ebp-8]
>     ...       ...                               ...
> 7   00401088  7D 32                             jge 004010bch
>     for(j=0; j<64; j++)
> 8   0040108A  C7 45 FC 00 00 00 00              mov[ebp-4], 0
>     ...       ...                               ...
>         a[i][j]=10;
>     ...       ...                               ...
> 19  004010AE  C7 84 82 00 20 42 00 0A 00 00 00  mov[ecx+edx*4+00422000h], 0Ah
> 20  ...       ...                               ...
> ```
> 
> 请回答下列问题。
> 
> (1) 第 20 条指令的虚拟地址是多少？
> 
> (2) 已知第 2 条 jmp 和第 7 条 jge 都是跳转指令，其操作码分别是 EBH 和 7DH，跳转地址分别为 0040 1084H、0040 10BCH，这两条指令都采用什么寻址方式？给出第 2 条指令 jmp 的跳转目标地址计算过程。
> 
> (3) 已知第 19 条 mov 指令的功能是 “`a[i][j]←10`”，其中 ecx 和 edx 为寄存器名，0042 2000H 是数组 a 的首地址，指令中源操作数采用什么寻址方式？已知 edx 中存放的是变量 j，ecx 中存放的是什么？根据该指令的机器码判断计算机 M 采用的是大端还是小端方式。
> 
> (4) 第一次执行第 19 条指令时，取指令过程中是否会发生缺页异常？为什么？
### 解
> [!done]+
> (1) 第 20 条指令的[[虚拟地址]]是 004010B9H。第 19 条指令的虚拟地址是 004010AEH，指令内容为 “C7 84 82 00 20 42 00 0A 00 00 00”（从左到右为从低字节到高字节的内容），占 11 字节，根据题 43，计算机 M 按字节编址，所以第 19 条指令占 11 个[[地址空间]]，所以第 20 条指令的虚拟地址是 004010AEH+11=004010B9H。
> 
> (2) 第一问。第 2 条 jmp 指令和第 7 条 jge 指令都采用[[相对寻址]]方式。
> 
> 第二问。相对寻址过程为首先执行 (PC)+1→PC，然后执行 EA=(PC)+A，第 2 条 jmp 指令内容为 EB 09H，占 2 字节。根据题 43，计算机 M 按字节编址，所以第 2 条指令占 2 个地址空间，
> 
> 第 2 条 jmp 指令地址为 00401079H，下一条指令地址为 00401079H+2H=0040107BH，或者直接读第 3 条指令地址为 0040107BH，跳转目标地址为 00401084H，跳转目标地址 EA = 下一条指令地址（= 当前指令地址 + 当前指令字的编址单位数）+ 偏移 A，即 00401084H = 00401079H + 2H + A，解得 A=9H。第 2 条指令 jmp 的跳转目标地址 00401084H=00401079H+2H+9H。
> 
> (3) 第一问。第 19 条指令中源操作数采用[[立即寻址]]方式。根据第 19 条的汇编代码 `mov[ecx+edx*4+00422000h], 0Ah`，mov 为传送指令，源操作数 0Ah 为立即数，所以源操作数采用立即寻址方式。
> 
> 第二问。ecx 存放的是 i×256。`a[i][j]` 的地址 = `a[0][0]` 的地址 + 4(64i+j)=`a[0][0]` 的地址 + 256i+4j，对应表达式 `ecx+edx*4+00422000h，a[0][0]` 的地址为 00422000h，edx 中存放的是变量 j，显然 ecx 存放的是 256i，即 i×256。
> 
> 第三问。计算机 M 采用的是小端方式。第 19 条指令内容 “ $\rm C7\ 84\ 82\ \underbrace{00\ 20\ 42\ 00}_{\text{地址字段}} \underbrace{\ 0A}_{\text{立即数}}\ 00\ 00\ 00$ ”（从左到右为从低字节到高字节的内容）中 “00 20 42 00”（从左到右为从低字节到高字节的内容）部分对应 00422000h，低字节内容在低地址，高字节内容在高地址，显示是[[小端方式]]。
> 
> (4) 第一次执行第 19 条指令时取指令过程中不会发生[[缺页处理|缺页异常]]。根据 43 题问题 (1) 中第三问，虚拟地址低 12 位为页内地址，高 20 位为虚页号。第 19 条指令地址 $\rm \underbrace{00401}_{\text{虚页号}}\underbrace{0AE}_{\text{页内地址}}H$ 和第 1 条指令地址 $\rm \underbrace{00401}_{\text{虚页号}}\underbrace{072}_{\text{页内地址}}H$ 的虚页号相同，位于同一页，访问第 1 条指令后，虚页号 00401H 的页面一定位于主存中，所以第 19 条指令时不会发生缺页异常。