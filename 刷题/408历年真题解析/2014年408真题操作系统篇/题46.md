---
publish: true
tags: 
aliases: 
finished: true
title: 题46
created: "2024-11-21 06:43"
updated: "2024-11-21 07:40"
---
## 题46
### 题目
> [!question]+
> （7 分）
> 
> 文件 F 由 200 条记录组成，记录从 1 开始编号。用户打开文件后，欲将内存中的一条记录插入文件 F 中，作为其第 30 条记录。请回答下列问题，并说明理由。
> 
> (1) 若文件系统采用连续分配方式，每个磁盘块存放一条记录，文件 F 存储区域前后均有足够的空闲磁盘空间，则完成上述插入操作最少需要访问多少次磁盘块？F 的文件控制块内容会发生哪些改变？
> 
> (2) 若文件系统采用链接分配方式，每个磁盘块存放一条记录和一个链接指针，则完成上述插入操作需要访问多少次磁盘块？若每个存储块大小为 1KB，其中 4B 存放链接指针，则该文件系统支持的文件最大长度是多少？
### 解
> [!done]+
> 文件物理结构就是典型的数据结构的应用。
> 
> (1) 第一问。若文件系统采用连续分配方式，则插入记录可能需要移动其他的记录块。文件 F 共有 200 条记录，要插入新记录作为第 30 条，而存储区前后均有足够的磁盘空间，且题目要求最少的访问磁盘块数（原因是访问磁盘块非常耗时），若移动第 30 条记录后面的记录，则需要移动 170 条记录，若移动第 30 条记录前面的记录，则需要移动 29 条记录，显然后一种策略是最优策略。第一步，将文件前 29 条记录依次前移一个位置，移动一条记录读取和写回磁盘各需访问一次磁盘块，这步操作需要访问磁盘块 29×(1+1)=58 次。第二步，插入新记录作为第 30 条，写入磁盘需要访问一次磁盘块，这步操作需要访问磁盘块 1 次。综上，完成上述插入操作最少需要访问 58+1=59 次磁盘块。
> 
> 第二问。文件控制块一般应包括下列的文件属性信息：
> 
> - 文件标志和控制信息：包括指示标识一个文件的符号名（操作系统可以进行按名存取）、文件状态标志、文件引用计数等等。
> - 文件逻辑结构信息：指示文件是流式文件还是记录式文件，是定长记录还是变长记录，记录数等。
> - 文件物理结构信息：指示文件在外存上的存储位置，包括存放文件的设备名、文件在外存的起始盘块号、指示文件所占用的盘块数或字节数的文件长度。
> - 文件使用信息：包括文件创建时间、上次一修改时间、当前使用信息等。
> - 文件管理信息：包括文件的访问权限和保护级别等。
> 
> 因为文件 F 的首个磁盘块发生移动，所以 F 的文件控制区的起始块号发生改变。因为文件 F 增加了一个磁盘块，所以 F 的文件控制区的文件长度发生改变。
> 
> (2) 第一问。若文件系统采用链接分配方式，插入记录并不用移动其他记录，只需要找到插入记录的直接前驱并修改该磁盘块的链接指针即可。第一步，找到第 30 条记录的直接前驱磁盘块即第 29 条记录所在的磁盘块，需要读文件的前 29 块的链接指针，每次读取需要访问一次磁盘块，这步要访问 29×1=29 次，第二步，修改该磁盘块的链接指针指向给第 30 条记录分配的磁盘块，每次写入需要访问一次磁盘块，这步要访问 1 次，第三步，插入新记录作为第 30 条，写入磁盘需要访问一次磁盘块，这步操作需要访问磁盘块 1 次。综上，完成上述插入操作需要访问 29+1+1 次磁盘块。
> 
> 第二问。若每个存储块大小为 1KB，其中链接指针占 4B=32bit，则最多可以表示 $2^{32}$ 个磁盘块位置，每个存储块除链接指针外可存放数据 1KB-4B=1024B-4B=1020B，推出该文件系统支持的文件最大长度是 1020B× $2^{32}$ =4080GB。