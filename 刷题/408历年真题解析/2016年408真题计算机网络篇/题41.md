---
publish: true
tags: 
aliases: 
finished: true
title: 题41
created: "2024-11-21 07:15"
updated: "2024-11-21 07:40"
---
## 题41
### 题目
> [!question]+
> （9 分）
> 
> 假设题 33～41 图中的 H3 访问 Web 服务器 S 时，S 为新建的 TCP 连接分配了 20 KB (K=1 024) 的接收缓存，最大段长 MSS=1 KB，平均往返时间 RTT=200 ms。H3 建立连接时的初始序号为 100，且持续以 MSS 大小的段向 S 发送数据，拥塞窗口初始阈值为 32 KB；S 对收到的每个段进行确认，并通告新的接收窗口。假定 TCP 连接建立完成后，S 端的 TCP 接收缓存仅有数据存入而无数据取出。请回答下列问题。
> ![](https://img.hwenyi.tech/202411211514672.webp)
> (1) 在 TCP 连接建立过程中，H3 收到的 S 发送过来的第二次握手 TCP 段的 SYN 和 ACK 标志位的值分别是多少？确认序号是多少？
> 
> (2) H3 收到的第 8 个确认段所通告的接收窗口是多少？此时 H3 的拥塞窗口变为多少？H3 的发送窗口变为多少？
> 
> (3) 当 H3 的发送窗口等于 0 时，下一个待发送的数据段序号是多少？H3 从发送第 1 个数据段到发送窗口等于 0 时刻为止，平均数据传输速率是多少（忽略段的传输延时）？
> 
> (4) 若 H3 与 S 之间通信已经结束，在 t 时刻 H3 请求断开该连接，则从 t 时刻起，S 释放该连接的最短时间是多少？
### 解
> [!done]+
> 建立 TCP 连接三次握手的过程如下：
> 
> ![](https://pica.zhimg.com/v2-759507e80851e1e52db72a9510af6a9c_r.jpg)
> 
> (1) 第一问。第二次握手的 TCP 段中，SYN=1 且 ACK=1。
> 
> 第二问。H3 建立连接时的初始序号为 100，即第一次握手序号 seq = x = 100。第二次握手的确认序号 ack=x+1=100+1=101。
> 
> (2) 发送方发送窗口 swnd = min {拥塞窗口 cwnd, 接收方接收窗口 rwnd}。
> 
> S 端的 TCP 接收缓存仅有数据存入而无数据取出。初始时，rwnd = 20 MSS
> 
> 发送方维持一个拥塞窗口 (congestion window, cwnd)，拥塞窗口的大小取决于网络的拥塞程度，并且动态地变化。发送方让自己的发送窗口等于拥塞窗口。
> 
> 发送方控制拥塞窗口的原则是：只要网络没有出现拥塞，拥塞窗口就再增大一些，以便把更多的分组发送出去。但只要网络出现拥塞，拥塞窗口就减小一些，以减少注入到网络中的分组数。
> 
> 最大报文段长度 (maximum segment size, MSS) 是 TCP 协议的一个选项，用于在 TCP 连接建立时，收发双方协商通信时每一个报文段所能承载的最大数据长度（不包括报文段头）。
> 
> **慢开始算法**
> 
> 开始时，将拥塞窗口设置为一个 MSS 的数值，每收到一个对新的报文段的确认后，把拥塞窗口增加至多一个 MSS 的数值。可以分析出，每经过一个传输轮次 (transmission round)，拥塞窗口大小加倍，逐渐增大到拥塞窗口的数值，一个传输轮次所经历的时间就是一个往返时间 RTT。
> 
> ![](https://pic4.zhimg.com/v2-7f8dab246bddc71a17c137c1532db18f_r.jpg)
> 
> **拥塞避免算法**
> 
> 每经过一个往返时间将发送方的窗口加 1。只要发送方判断网络出现拥塞，就将慢开始门限 ssthresh 设置为出现拥塞时发送方窗口值的一半，然后执行慢开始算法。
> 
> ![](https://pic2.zhimg.com/v2-eab1eeecea0558780a88224deefd2ca9_r.jpg)
> 
> 每经过一个往返时间将发送方的窗口加 1。只要发送方判断网络出现拥塞，就将慢开始门限 ssthresh 设置为出现拥塞时发送方窗口值的一半，然后执行慢开始算法。
> 
> <table data-draft-node="block" data-draft-type="table" data-size="normal" data-row-style="normal"><tbody><tr><td></td><td>发送方每收到一个对新的报文段的确认后拥塞窗口大小变化</td><td>发送方每经过一个轮次后拥塞窗口大小变化</td></tr><tr><td>慢开始算法</td><td>拥塞窗口大小增加至多 1 个 MSS。若拥塞窗口大小未达到慢开始门限 ssthresh，则拥塞窗口大小增加 1 个 MSS；若拥塞窗口大小达到慢开始门限 ssthresh，则拥塞窗口大小不变。</td><td>本轮次拥塞窗口大小是上一个轮次拥塞窗口大小的两倍且不超过慢开始门限 ssthresh。即当前轮次的拥塞窗口 = min{2× 上一轮轮次的拥塞窗口, ssthresh}</td></tr><tr><td>拥塞避免算法</td><td>若已发送报文段不是该轮次最后一个报文段，则拥塞窗口大小不变；若已发送报文段是该轮次最后一个报文段，则拥塞窗口大小增加 1 个 MSS。</td><td>本轮次拥塞窗口大小在上一个轮次拥塞窗口大小的基础上增加 1 个 MSS。即当前轮次的拥塞窗口 = 上一轮轮次的拥塞窗口 + 1 MSS</td></tr></tbody></table>
> 
> 接下来对本题进行分析。
> 
> 拥塞窗口初始阈值为 32 KB，20 KB < 32 KB，即便在一个 RTT 中发送 20KB 数据都不会触发拥塞避免算法。可以断言从 H3 发送第 1 个 TCP 段到 H3 收到的第 20 个确认段所通告时慢开始算法都适用，不会触发拥塞避免算法。也就意味着从 H3 发送第 1 个 TCP 段到 H3 收到的第 8 个确认段所通告时慢开始算法都适用，不会触发拥塞避免算法。因此，慢开始算法每收到一个对新的报文段的确认后，把拥塞窗口增加一个 MSS 的数值。本题中最大段长 MSS=1 KB。
> 
> 第一问。初始时 S 端的 TCP 接收缓存为 20 KB，且该接收缓存仅有数据存入而无数据取出。H3 收到的第 8 个确认段所通告时，已经传输了 8 KB 的数据，剩余接收窗口是 rwnd = 20 KB - 8 KB = 12 KB。
> 
> 第二问。此时执行的是慢开始算法，H3 的拥塞窗口为此前加 1 MSS，推出 H3 的拥塞窗口为执行慢开始算法期间已经确认的报文段数加 1 MSS，所以 cwnd = 8 KB + 1 KB = 9 KB，即 cwnd = 9 KB。
> 
> 第三问。H3 的发送窗口 swnd = min{cwnd, rwnd} = min {9 KB, 12 MSS} = 9 KB，即 swnd = 9 KB。
> 
> (3) 第一问。当 H3 的发送窗口等于 0 时，说明已经发送了 20 个 TCP 段，接下来准备发送第 21 个 TCP 段，已经发送的字节数为 20 KB / B= 20 × 1024 = 20480，H3 建立连接时的初始序号 seq=x=100，第三次握手时初始序号 seq=x+1=101，即从序号 101 字节开始传输，第 21 个 TCP 段从序号 101+20480 = 20581 字节开始传输，即下一个待发送数据段序号是 20581。
> 
> 第二问。根据 (2) 的分析，从 H3 发送第 1 个 TCP 段到 H3 收到的第 20 个确认段所通告时慢开始算法都适用，不会触发拥塞避免算法。
> 
> 第 1 个 RTT 开始时，采用慢开始算法，拥塞窗口 cwnd = 1MSS，S 的接收窗口 rwnd = 20 MSS。
> 
> H3 的发送窗口 swnd = min{cwnd, rwnd} = min {1 MSS, 20 MSS} = 1MSS，此时可以将第 1 个 TCP 段连续发送出去。
> 
> 第 2 个 RTT 开始时，调整当前拥塞窗口大小为上一轮次拥塞窗口大小的两倍，拥塞窗口 cwnd = 2 MSS，S 的接收窗口 rwnd = 20 MSS -1 MSS = 19 MSS。H3 的发送窗口 swnd = min{cwnd, rwnd} = min {2 MSS, 19 MSS} = 2 MSS，此时可以将第 2、3 个 TCP 段连续发送出去。
> 
> 第 3 个 RTT 开始时，调整当前拥塞窗口大小为上一轮次拥塞窗口大小的两倍，拥塞窗口 cwnd = 4 MSS，S 的接收窗口 rwnd = 19 MSS - 2MSS =17 MSS。H3 的发送窗口 swnd = min{cwnd, rwnd} = min {4 MSS, 17 MSS} = 4 MSS，此时可以将第 4、5、6、7 个 TCP 段连续发送出去。
> 
> 第 4 个 RTT 开始时，调整当前拥塞窗口大小为上一轮次拥塞窗口大小的两倍，拥塞窗口 cwnd = 8 MSS，S 的接收窗口 rwnd = 17 MSS - 4 MSS = 13 MSS。H3 的发送窗口 swnd = min{cwnd, rwnd} = min {8 MSS, 13 MSS} = 8 MSS，此时可以将第 8、9、10、11、12、13、14、15 个 TCP 段连续发送出去。
> 
> 第 5 个 RTT 开始时，调整当前拥塞窗口大小为上一轮次拥塞窗口大小的两倍，拥塞窗口 cwnd = 16 MSS，S 的接收窗口 rwnd = 13 MSS - 8 MSS = 5 MSS。H3 的发送窗口 swnd = min{cwnd, rwnd} = min {16 MSS, 5 MSS} = 5 MSS，此时可以将第 16、17、18、19、20 个 TCP 段连续发送出去。
> 
> 为了简化模型，同一个 TCP 段的发送和确认在同一个 RTT 内完成，可画出如下示意图。
> 
> ![](https://pic3.zhimg.com/v2-f02820f39e321b73ba583f99b63e77fa_r.jpg)
> 
> 到此为止，发送这 20 个 TCP 段需要 5 个 RTT，RTT = 200ms，5RTT = 1s，忽略段的传输延时，总时间为 1s。发送数据量为 20 KB。
> 
> 平均数据传输率为 $\displaystyle{\frac{20\text{ KB}}{1\text{ s}} = \frac{20\times1024\times8\text{ bit}}{1\text{ s}}=163.84\text{ bps}}$ 。
> 
> (4) 释放 TCP 连接四次挥手的过程如下：
> 
> ![](https://pic3.zhimg.com/v2-a5cc8d7e009c25277afe78fa8e97fad8_r.jpg)
> 
> 为了使释放 TCP 连接的时间最短，CLOSE-WAIT 期间不再进行数据传输，CLOSE-WAIT 和 FIN-WAIT-2 的时间为 0，释放 TCP 连接四次挥手的过程就变成了三次挥手，过程如下：
> 
> ![](https://pica.zhimg.com/v2-51da1fec2d9b7e06330d6ba86e696b86_r.jpg)
> 
> 忽略段的传输延时，每次挥手的传播时延为 0.5 RTT，如下图所示。
> 
> ![](https://pica.zhimg.com/v2-056e9a8f8ce288de77a4130fc240df78_r.jpg)
> 
> 整个过程需要 3×0.5 RTT = 1.5 RTT，RTT = 200ms，1.5 RTT = 1.5×200ms=300ms。即从 t 时刻起，S 释放该连接的最短时间是 300ms。
> 
> **_举一反三_**
> 
> 如果增加本题的难度，可以修改为会触发拥塞避免算法的情况。
> 
> 假设题 33～41 图中的 H3 访问 Web 服务器 S 时，S 为新建的 TCP 连接分配了 200 KB (K=1 024) 的接收缓存，最大段长 MSS=1 KB，平均往返时间 RTT=200 ms。H3 建立连接时的初始序号为 100，且持续以 MSS 大小的段向 S 发送数据，拥塞窗口初始阈值为 32 KB；S 对收到的每个段进行确认，并通告新的接收窗口。假定 TCP 连接建立完成后，S 端的 TCP 接收缓存仅有数据存入而无数据取出。请回答下列问题。
> 
> (1) 在 TCP 连接建立过程中，H3 收到的 S 发送过来的第二次握手 TCP 段的 SYN 和 ACK 标志位的值分别是多少？确认序号是多少？
> 
> (2) H3 收到的第 96 个确认段所通告的接收窗口是多少？此时 H3 的拥塞窗口变为多少？H3 的发送窗口变为多少？
> 
> (3) 当 H3 的发送窗口等于 0 时，下一个待发送的数据段序号是多少？H3 从发送第 1 个数据段到发送窗口等于 0 时刻为止，平均数据传输速率是多少（忽略段的传输延时）？
> 
> (4) 若 H3 与 S 之间通信已经结束，在 t 时刻 H3 请求断开该连接，则从 t 时刻起，S 释放该连接的最短时间是多少？
> 
> 参考答案：
> 
> (1) 第二次握手 TCP 段的 SYN=1，ACK=1；确认序号是 101。
> 
> (2) H3 收到的第 96 个确认段所通告的接收窗口是 104 KB；此时 H3 的拥塞窗口变为 34 KB；H3 的发送窗口变为 34 KB。
> 
> (3) 当 H3 的发送窗口等于 0 时，下一个待发送段的序号是 200K+101=200×1024+101=204901；H3 从发送第 1 个段到发送窗口等于 0 时刻为止，平均数据传输速率是 200KB/(10×200ms) = 200 KB/2s = 819.2 kbps。
> 
> (4) 从 t 时刻起，S 释放该连接的最短时间是 1.5×200ms=300ms。