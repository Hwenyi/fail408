---
publish: true
tags: 
aliases: 
finished: true
title: 题47
created: "2024-11-21 07:14"
updated: "2024-11-21 07:40"
---
## 题47
### 题目
> [!question]+
> （9 分）
> 
> 某磁盘文件系统使用链接分配方式组织文件，簇大小为 4KB。目录文件的每个目录项包括文件名和文件的第一个簇号，其他簇号存放在文件分配表 FAT 中。
> 
> (1) 假定目录树如下图所示，各文件占用的簇号及顺序如下表所示，其中 dir、dir1 是目录，file1、file2 是用户文件。请给出所有目录文件的内容。
> 
> ![](https://img.hwenyi.tech/202411211513216.webp)
> 
> $\begin{array}{|c|}\hline \text{文件名}&\text{簇号}\\\hline \text{dir}&\text{1}\\ \text{dir1}&\text{48}\\ \text{file1}&\text{100、106、108}\\ \text{file2}&\text{200、201、202}\\\hline \end{array}$
> 
> (2) 若 FAT 的每个表项仅存放簇号，占 2 个字节，则 FAT 的最大长度为多少字节？该文件系统支持的文件长度最大是多少？
> 
> (3) 系统通过目录文件和 FAT 实现对文件的按名存取，说明 file1 的 106、108 两个簇号分别存放在 FAT 的哪个表项中。
> 
> (4) 假设仅 FAT 和 dir 目录文件已读入内存，若需将文件 dir/dir1/file1 的第 5000 个字节读入内存，则要访问哪几个簇？
### 解
> [!done]+
> (1) dir 文件夹中有 dir1，dir1 的第一个簇号为 48，所以 dir 目录文件中有目录项 < dir1, 48>。dir1 文件夹中有 file1 和 file2，file1 的第一个簇号为 100，file2 的第一个簇号为 200，所以 dir1 目录文件中有目录项 < file1, 100 > 和 < file2, 200>。dir 和 dir1 中的内容分别如下表所示。
> 
> ![](https://img.hwenyi.tech/202411211513217.webp)
> 
> (2) 第一问。每个簇号占 2B=16bit，最多表示 $2^{16}$ 个簇号，若 FAT 的每个表项仅存放簇号，则 FAT 的最大长度为 $2^{16}$ ×2B=128KB。
> 
> 第二问。最多有 $2^{16}$ 个簇，簇大小为 4KB，该文件系统支持的文件长度最大是 $2^{16}$ ×4KB=256MB。
> 
> (3) 由于磁盘文件系统使用链接分配方式组织文件，所以 FAT 的每个表项中会存放下一个簇号，file1 的簇号 106 存放在 FAT 的 100 号表项中，簇号 108 存放在 FAT 的 106 号表项中。
> 
> (4) 仅 FAT 和 dir 目录文件已读入内存，需要将文件 dir/dir1/file1 的第 5000 个字节读入内存。
> 
> 第一步：根据 dir 目录文件，访问目录文件 dir1 所在的 48 号簇。
> 
> 第二步：簇大小为 4KB，file1 的第 5000 个字节位于第 $\rm \lceil 5000B/4KB\rceil = 2$ 个簇中，file1 第 2 个簇的簇号为 106。首先根据 dir1 目录文件找到 file1 第一个簇的簇号 100，然后根据 FAT，100 号表项存放簇号 106，所以这一步仅需要访问文件 file1 的 106 号簇。
> 
> 注：偏移量、下标、索引、页号、页框号、行号、组号、位号、簇号、磁盘块号、主存块号等一般从 0 开始计数。特别地，在没有计数范围说明的情况下，第几个一般从 1 开始计数，即第一个、第二个、第三个……