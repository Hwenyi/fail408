---
publish: true
tags: 
aliases: 
finished: true
title: 题47
created: "2024-11-21 07:25"
updated: "2024-11-21 07:40"
---
## 题47
### 题目
> [!question]+
> （9 分）
> 
> 某校园网有两个局域网，通过路由器 R1、R2 和 R3 互联后接入 Internet，S1 和 S2 为以太网交换机。局域网采用静态 IP 地址配置，路由器部分接口以及各主机的 IP 地址如下图所示。
> 
> ![](https://pica.zhimg.com/v2-509ef6981bfad58d394dc69357aaa332_r.jpg)
> 
> 假设 NAT 转换表结构为：
> 
> ![](https://pic3.zhimg.com/v2-c46298aa9be14d3211f6c87be09ce930_r.jpg)
> 
> 请回答下列问题：
> 
> (1) 为使 H2 和 H3 能够访问 Web 服务器（使用默认端口号），需要进行什么配置？
> 
> (2) 若 H2 主动访问 Web 服务器时，将 HTTP 请求报文封装到 IP 数据报 P 中发送，则 H2 发送 P 的源 IP 地址和目的 IP 地址分别是什么？经过 R3 转发后，P 的源 IP 地址和目的 IP 地址分别是什么？经过 R2 转发后，P 的源 IP 地址和目的 IP 地址分别是什么？
### 解
> [!done]+
> (1) 本题考察 NAT 转换表的配置。使用端口号的 NAT 也叫做网络地址与端口号转换 NAPT (Network Address and Port Translation)，NAPT 允许多个内部地址映射带同一公有地址的不同端口，使得内网的多个主机可以使用外网的同一 IP 地址访问外网。
> 
> 为使 H2 和 H3 能够访问 Web 服务器，内网中的 H2 和 H3 要经过 R3 访问因特网，外网要经过 R2 访问另一个内网中的 Web 服务器。因此，
> 
> R3 要开启 NAT 功能，H2 的地址为 192.168.1.2，随机选择一个端口号，NAT 转换为 R3 在公有网络的 IP 地址 203.10.2.6，随机选择一个端口号，H3 的地址为 192.168.1.3，随机选择一个端口号，NAT 转换为 R3 在外网的 IP 地址 203.10.2.6，随机选择另一个端口号（不能和前面选择的冲突）。可以配置 NAT 表如下（举例，配置不唯一）：
> 
> ![](https://pic1.zhimg.com/v2-b4c93608fb9f77cd6dececed48ec0330_r.jpg)
> 
> 该 NAT 表也可以根据网络进行动态配置。
> 
> R2 要开启 NAT 功能，这里是进行 NAT 服务器配置，Web 服务器的 IP 地址为 192.168.1.2，默认端口号 80（Web 服务器默认使用 HTTP 协议进行访问，HTTP 使用 TCP 的端口号为 80），NAT 转换为 R2 在外网的 IP 地址 203.10.2.2，一般情况下，NAT 服务器配置不支持端口号改变（例如华为的 NAT 路由器），因此选择的端口号仍为 80。可以配置 NAT 表如下：
> 
> ![](https://pic2.zhimg.com/v2-2c9790e6ac13b6f14c09b512d8ed802b_r.jpg)
> 
> 注意：TCP 与 UDP 段结构中端口地址都是 16 比特，可以有在 0~65535 范围内的端口号。对于这 65536 个端口号有以下的使用规定：
> 
> - 端口号小于 256 的定义为常用端口，服务器一般都是通过常用端口号来识别的。任何 TCP/IP 实现所提供的服务都用 1~1023 之间的端口号，是由 ICANN 来管理的；端口号从 1024~49151 是被注册的端口，也成为 “用户端口”，被 IANA 指定为特殊服务使用；
> - 客户端只需保证该端口号在本机上是唯一的就可以了。客户端端口号因存在时间很短暂又称临时端口号；
> - 大多数 TCP/IP 实现给临时端口号分配 1024~5000 之间的端口号。大于 5000 的端口号是为其他服务器预留的。
> 
> (2) 由于启用了 NAT 服务，H2 发送的数据报 P 的源 IP 地址应该是 H2 的内网地址，目的地址应该是 R2 的外网 IP 地址，源 IP 地址是 192.168.1.2，目的 IP 地址是 203.10.2.2。
> 
> R3 转发后，将数据报 P 的源 IP 地址改为 R3 的外网 IP 地址，目的 IP 地址仍然不变，源 IP 地址是 203.10.2.6，目的 IP 地址是 203.10.2.2。
> 
> R2 转发后，将数据报 P 的目的 IP 地址改为 Web 服务器的内网地址，源地址仍然不变，源 IP 地址是 203.10.2.6，目的 IP 地址是 192.168.1.2。