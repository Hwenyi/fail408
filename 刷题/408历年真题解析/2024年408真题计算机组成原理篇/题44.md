---
publish: true
tags: 
aliases: 
finished: true
title: 题44
created: "2024-11-21 07:37"
updated: "2024-11-21 07:40"
---
## 题44
### 题目
> [!question]+
> （本题 10 分）
> 
> 对于题 43 中的计算机 M，C 语言程序 P 包含的语句 “`sum += a[i];`” 在 M 中对应的指令序列 S 如下。
> 
> ```cpp
> slli r4, r2, 2 // R[r4]←R[r2]<<2
> add r4, r3, r4 // R[r4]←R[r3]+R[r4]
> lw r5, 0(r4) // R[r5]←M[R[r4]+0]
> add r1, r1, r5 // R[r1]←R[r1]+R[r5]
> ```
> 
> 已知变量 i、sum 和数组 a 都为 int 型，通用寄存器 r1~r5 的编号为 01 H ~ 05 H。
> 
> 请回答下列问题。
> 
> (1) 根据指令序列 S 中每条指令的功能，写出存放数组 a 的首地址、变量 i、变量 sum 的通用寄存器编号。（3 分）
> 
> (2) 已知 M 为小端方式计算机，采用页式存储管理方式，页大小为 4 KB。若执行到指令序列 S 中第一条指令时，i=5，且 r1 和 r3 的内容分别为 0000 1332 H 和 0013 DFF0 H，从地址 0013 DFF0 H 开始的存储单元内容如题 44 图所示，则执行 “`sum+=a[i];`” 语句后，`a[i]` 的地址、`a[i]` 和 sum 的机器数分别是什么（用十六进制表示）？`a[i]` 所在页的页号是多少？此次执行中，数组 a 至少存放在几页中？（5 分）
> 
> ![](https://pic2.zhimg.com/v2-64367147a7e2eca6c865844cd5163769_r.jpg)
> 
> (3) 指令 “slli r4, r2, 2” 的机器码是什么（用十六进制表示）？若数组 a 改为 short 类型，则指令序列 S 中 slli 指令的汇编形式应是什么？（2 分）
### 解
> [!done]+
> (1) a 的首地址存放在 r3；i 存放在 r2；sum 存放在 r1。
> 
> 可以按照指令顺序进行推理。
> 
> 已知变量 i、sum 和数组 a 都为 int 型，int 占 32 bit = 4 B，根据题 43 题目条件，计算机 M 按字节编址，一个变量占 4 个地址单元，C 语言中数组从低地址到高地址连续存放，所以 a[i] 的地址相比数组 a 的首地址（C 语言数组下标从 0 开始，数组 a 的首地址即 a[0] 的地址）偏移 (i - 0) × 4 = i << 2 个地址单元，可以推出指令 “slli r4, r2, 2 // R[r4]←R[r2]<<2” 为计算 a[i] 地址距离 a 首地址的偏移量，其中计算结果 4i 临时存放在 r4，i 存放在 r2。
> 
> a[i] 地址 = a 地址 + 4i，对应指令 “add r4, r3, r4 // R[r4]←R[r3]+R[r4]”，a[i] 地址临时存放在 r4，a 的地址存放在 r3。
> 
> 接下来显然是根据 a[i] 地址去内存中取出 a[i] 的值，对应指令 “lw r5, 0(r4) // R[r5]←M[R[r4]+0]”，此时 a[i] 的值临时存放在 r5。
> 
> 最后必须执行 “sum+=a[i];”，等价于 “sum = sum + a[i];”，对应指令 “add r1, r1, r5 // R[r1]←R[r1]+R[r5]”，sum 存放在 r1。
> 
> (2) 第一问。分三个点，a[i] 的地址为 0013 E004 H；a[i] 的机器数为 FFFF ECDC H；sum 的机器数为 0000 000E H。
> 
> 根据 (1)，sum 存放在 r1，a 的首地址存放在 r3，根据 (2) 条件 i=5，且 r1 和 r3 的内容分别为 0000 1332 H 和 0013 DFF0 H，所以此时 i = 5、sum = 0000 1332 H 且 a 的首地址为 0013 DFF0 H，a[i] 的地址 = a 的首地址 + 4 i，代入得到 a[i] 的地址 = 0013 DFF0 H + 4 H × 5 = 0013 E004 H。
> 
> 已知 a[i] 的地址为 0013 E004 H，a[i] 为 int 占 4 字节，读取题 44 图中从 0013 E004 H 开始的 4 字节内容，为 DC EC FF FF，因为 M 按按字节编址，M 采用小端方式，推出该小端方式按照低字节到高字节内容编址，需要将该内容转化为大端方式，大端方式与人的书写顺序一致，得到 FF FF EC DC，即 a[i] 的机器数为 FFFF ECDC H。
> 
> 初始时 sum = 0000 1332 H，a[i] = FFFF ECDC H，执行 “sum += a[i];” 语句后，sum = 0000 1332 H + FFFF ECDC H = (1) 0000 000E H，即 sum 的机器数为 0000 000E H。
> 
> 第二问。a[i] 所在页的页号是 0013E H。
> 
> 计算机 M 采用页式存储管理方式，虚拟地址格式为$\begin{array}{|c|}\hline 页号&页内偏移量\\\hline \end{array}$。
> 
> 根据题 43 条件，计算机 M 字长 32 位，即虚拟地址长度为 32 位。又计算机 M 按字节编址，采用页式存储管理方式，页大小为 4 KB = $2^{12}$ B，页内偏移量占低 12 位，推出页号占高 32 - 12 = 20 位。推出页式存储虚拟地址结构如下。
> 
> <table data-draft-node="block" data-draft-type="table" data-size="normal" data-row-style="normal"><tbody><tr><td>页号（20 位）</td><td>页内偏移量（12 位）</td></tr></tbody></table>
> 
> a[i] 地址 $\rm \underbrace{0013E}_{\text{页号}}\underbrace{004}_{\text{页内偏移量}}{H}$ ，所以 a[i] 所在页的页号是 0013E H。
> 
> 第三问。数组 a 至少存放在 2 页中。
> 
> 此次执行中，a[i] 和 a[i] 前的元素一定存在，a 首地址 $\rm \underbrace{0013D}_{\text{页号}}\underbrace{FF0}_{\text{页内偏移量}}{H}$ ，C 语言数组下标从 0 开始，a[0] 所在页的页号是 0013D H，又根据前一问答案，a[i] 所在页的页号是 0013E H。a[0], a[1], a[2], ..., a[i-1], a[i] 连续存放，要占据从页号从 0013D H 到 0013E H 的连续页，即页号为 0013D H、0013E H 的页，总共有 2 页，因为 a[i] 后可能还有元素，即可能需要更多页，所以数组 a 至少存放在 2 页中。
> 
> (3) 第一问。指令机器码为 0021 2213 H。
> 
> 根据题 43 图 (a) 中 slli 指令的格式和指令 “slli r4, r2, 2 // R[r4]←R[r2]<<2”，shamt 位于 IR[24 : 20] 占 5 位并对应 2 = 00010 B，rs1 位于 IR[19 : 15] 占 5 位并对应 r2，rd 位于 IR[11 : 7] 占 5 位并对应 r4。通用寄存器 r1~r5 的编号为 01 H ~ 05 H，所以 r2 的编号为 02 H = 00010 B，r4 的编号为 04 H = 00100 B 得到该指令格式如下。
> 
> ![](https://pic2.zhimg.com/v2-d14e5d1f4acf017f7f9a19297d34ab45_r.jpg)
> 
> 0000 0000 0010 0001 0010 0010 0001 0011 B = 0021 2213 H。
> 
> 第二问。汇编形式是 slli r4, r2, 1。
> 
> 数组 a 改为 short 型，short 占 16 bit = 2 B，根据题 43 题目条件，计算机 M 按字节编址，一个变量占 2 个地址单元，C 语言中数组从低地址到高地址连续存放，所以 a[i] 的地址相比数组 a 的首地址（C 语言数组下标从 0 开始，数组 a 的首地址即 a[0] 的地址）偏移 (i - 0) × 2 = i << 1 个地址单元，指令修改为 “slli r4, r2, 1 // R[r4]←R[r2]<<1” 为计算 a[i] 地址距离 a 首地址的偏移量。因此此时汇编形式是 slli r4, r2, 1。