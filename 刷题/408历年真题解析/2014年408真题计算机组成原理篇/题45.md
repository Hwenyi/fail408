---
publish: true
tags: 
aliases: 
finished: true
title: 题45
created: "2024-11-21 06:44"
updated: "2024-11-21 07:40"
---
## 题45
### 题目
> [!question]+
> （12 分）
> 
> 假设对于题 44 中的计算机 M 和程序段 P 的机器代码，M 采用页式虚拟存储管理；P 开始执行时，(R1)=(R2)=0，(R6)=1000，其机器代码已调入主存但不在 Cache 中；数组 A 未调入主存，且所有数组元素在同一页，并存储在磁盘同一个扇区。请回答下列问题并说明理由。
> 
> (1) P 执行结束时，R2 的内容是多少？
> 
> (2) M 的指令 Cache 和数据 Cache 分离。若指令 Cache 共有 16 行，Cache 和主存交换的块大小为 32 字节，则其数据区的容量是多少？若仅考虑程序段 P 的执行，则指令 Cache 的命中率为多少？
> 
> (3) P 在执行过程中，哪条指令的执行可能发生溢出异常？哪条指令的执行可能产生缺页异常？对于数组 A 的访问，需要读磁盘和 TLB 至少各多少次？
### 解
> [!done]+
> (1) R2 里装的是 i 的值，循环条件是 i<N，N 在寄存器 R6 中，(R6)=1000，即循环条件是 i<1000，当 i 自增到不满足这个条件时跳出循环，程序结束，所以此时 i 的值为 1000。
> 
> (2) Cache 共有 16 块，每块 32 字节，所以 Cache 数据区的容量为 16×32B=512B。根据题 44(1) 的结论，计算机按字节编址，Cache 块占 32B= $2^5$B，块内偏移占 5 位。P 共有 6 条指令，一条指令占 4B，6 条指令占 6×4=24B，小于一个主存块大小 32B，且程序段 P 起始地址为 08048100H，指令 1 起始地址为 08048100H，低 5 位全 0，块内偏移为 0，对应一个主存块的起始位置，6 条指令连续存放，由此可知所有指令都在一个主存块内。读取指令 1 时会发生 Cache 缺失，所以将 P 所在的主存块调入 Cache 某一块，以后每次读取指令时，都能在指令 Cache 中命中。因此在 1000 次循环中，只会发生 1 次指令访问缺失，所以指令 Cache 的命中率为 (1000×6-1)/(1000×6)=99.98%。
> 
> (3) 第一问。指令 4 为加法指令，即对应 sum+=A[i]，当数组 A 中元素的值过大时，则会导致这条加法指令发生溢出异常；而指令 2、5 虽然都是加法指令，但它们分别为数组地址的计算指令和存储变量 i 的寄存器进行自增的指令，而 i 最大到达 1000，所以它们都不会产生溢出异常。
> 
> 第二问。只有访存指令可能产生缺页异常，因为数组 A 未调入主存，即第一次调用指令 3 时访问 A[0] 时产生缺页异常。需要访问磁盘一次。
> 
> 第三问。因为数组 A 未调入主存，且数组 A 所有元素在同一页，并存储在磁盘同一个扇区。所以该程序仅需访盘一次，此后数组 A 的元素都在内存中，则不会导致访盘。每访问一次内存数据就会查 TLB 一次，第一次访问 A[0] 会先查一次 TLB，然后产生缺页，处理完缺页中断后，会重新访问 A[0]，此时又查 TLB 一次。所以 A[0] 需要访问两次 TLB 才能从 TLB 中获得，剩余元素 A[1], A[2], ..., A[999] 均可从 TLB 中获得，共访问 TLB 的次数是 2×1+1×999=1001 次。或每个元素均需要访问 TLB 一次，考虑第一次访问 TLB 但 TLB 缺失需要多要多访问 TLB 的一次，共访问 TLB 的次数是 1×1000+1=1001 次。
> 
> 参考 2009 年题 46，在带有 TLB 的请求分页管理系统中通过虚地址访问其对应的主存中的数据的过程总结如下：
> 
> ![](https://pic2.zhimg.com/v2-5095262a83ad286cc7b92d0e704a1155_r.jpg)